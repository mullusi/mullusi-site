<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MulluOS ‚Äî SCCM Math Solver</title>
  <style>
    :root {
      --bg-primary: #0a0a12;
      --bg-secondary: #12121f;
      --bg-tertiary: #1a1a2e;
      --accent-purple: #9d4edd;
      --accent-cyan: #00d4ff;
      --accent-green: #00ff88;
      --accent-gold: #ffd700;
      --accent-red: #ff4757;
      --text-primary: #e8e8ff;
      --text-secondary: #a0a0c0;
      --border-color: #2a2a4e;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      text-align: center;
      padding: 30px 0;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 30px;
    }
    
    h1 {
      font-size: 2.5em;
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
    }
    
    .subtitle {
      color: var(--text-secondary);
      font-size: 1.1em;
    }
    
    .main-grid {
      display: grid;
      grid-template-columns: 300px 1fr 350px;
      gap: 20px;
    }
    
    @media (max-width: 1200px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }
    
    .panel {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
    }
    
    .panel-title {
      font-size: 1.2em;
      color: var(--accent-cyan);
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }
    
    /* Category Buttons */
    .categories {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .category-btn {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
      font-size: 0.95em;
    }
    
    .category-btn:hover {
      background: var(--bg-primary);
      border-color: var(--accent-purple);
    }
    
    .category-btn.active {
      background: linear-gradient(135deg, rgba(157, 78, 221, 0.2), rgba(0, 212, 255, 0.2));
      border-color: var(--accent-purple);
    }
    
    .category-icon {
      margin-right: 10px;
    }
    
    /* Main Solver Area */
    .solver-area {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .input-section {
      background: var(--bg-tertiary);
      border-radius: 10px;
      padding: 20px;
    }
    
    .input-section label {
      display: block;
      color: var(--text-secondary);
      margin-bottom: 8px;
      font-size: 0.9em;
    }
    
    .input-row {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    input[type="text"], input[type="number"], textarea {
      flex: 1;
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 1em;
      font-family: 'Fira Code', monospace;
    }
    
    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent-cyan);
      box-shadow: 0 0 10px rgba(0, 212, 255, 0.2);
    }
    
    textarea {
      min-height: 100px;
      resize: vertical;
    }
    
    .solve-btn {
      background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
      color: white;
      border: none;
      padding: 14px 28px;
      border-radius: 8px;
      font-size: 1.1em;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      width: 100%;
    }
    
    .solve-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(157, 78, 221, 0.4);
    }
    
    /* Results */
    .result-section {
      background: var(--bg-tertiary);
      border-radius: 10px;
      padding: 20px;
    }
    
    .result-title {
      color: var(--accent-green);
      font-size: 1.1em;
      margin-bottom: 15px;
    }
    
    .result-value {
      font-family: 'Fira Code', monospace;
      font-size: 1.4em;
      color: var(--accent-gold);
      padding: 15px;
      background: var(--bg-primary);
      border-radius: 8px;
      margin-bottom: 15px;
      word-break: break-all;
    }
    
    /* Causal Chain Display */
    .causal-chain {
      background: var(--bg-primary);
      border-radius: 8px;
      padding: 15px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .causal-step {
      padding: 10px;
      border-left: 3px solid var(--accent-purple);
      margin-bottom: 10px;
      background: var(--bg-secondary);
      border-radius: 0 8px 8px 0;
    }
    
    .causal-step-number {
      color: var(--accent-cyan);
      font-weight: bold;
      margin-right: 10px;
    }
    
    .causal-step-effect {
      color: var(--text-primary);
      font-family: 'Fira Code', monospace;
    }
    
    .causal-step-reason {
      color: var(--text-secondary);
      font-size: 0.85em;
      margin-top: 5px;
      font-style: italic;
    }
    
    .causal-arrow {
      text-align: center;
      color: var(--accent-purple);
      font-size: 1.2em;
      margin: 5px 0;
    }
    
    /* Examples Panel */
    .examples-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .example-item {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      padding: 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .example-item:hover {
      border-color: var(--accent-cyan);
      background: var(--bg-primary);
    }
    
    .example-title {
      color: var(--accent-cyan);
      font-size: 0.9em;
      margin-bottom: 5px;
    }
    
    .example-code {
      font-family: 'Fira Code', monospace;
      color: var(--text-secondary);
      font-size: 0.85em;
    }
    
    /* Quick Operations */
    .quick-ops {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
      margin-bottom: 15px;
    }
    
    .quick-op-btn {
      background: var(--bg-primary);
      border: 1px solid var(--border-color);
      color: var(--text-primary);
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      font-family: 'Fira Code', monospace;
      transition: all 0.2s;
    }
    
    .quick-op-btn:hover {
      background: var(--bg-secondary);
      border-color: var(--accent-purple);
    }
    
    /* Status indicator */
    .status {
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 0.9em;
    }
    
    .status.success {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid var(--accent-green);
      color: var(--accent-green);
    }
    
    .status.error {
      background: rgba(255, 71, 87, 0.1);
      border: 1px solid var(--accent-red);
      color: var(--accent-red);
    }
    
    .status.info {
      background: rgba(0, 212, 255, 0.1);
      border: 1px solid var(--accent-cyan);
      color: var(--accent-cyan);
    }
    
    /* Additional inputs for specific operations */
    .extra-inputs {
      display: none;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid var(--border-color);
    }
    
    .extra-inputs.visible {
      display: block;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üîÆ MulluOS SCCM Math Solver</h1>
      <p class="subtitle">Symbolic Causal Chain Mathematics ‚Äî Every computation is traceable</p>
    </header>
    
    <div class="main-grid">
      <!-- Left Panel: Categories -->
      <div class="panel">
        <h2 class="panel-title">üìö Math Categories</h2>
        <div class="categories">
          <button class="category-btn active" data-category="arithmetic">
            <span class="category-icon">üî¢</span> Arithmetic & Number Theory
          </button>
          <button class="category-btn" data-category="algebra">
            <span class="category-icon">üìê</span> Algebra & Expressions
          </button>
          <button class="category-btn" data-category="calculus">
            <span class="category-icon">‚à´</span> Calculus
          </button>
          <button class="category-btn" data-category="linear">
            <span class="category-icon">üìä</span> Linear Algebra
          </button>
          <button class="category-btn" data-category="equations">
            <span class="category-icon">‚öñÔ∏è</span> Equation Solving
          </button>
          <button class="category-btn" data-category="combinatorics">
            <span class="category-icon">üé≤</span> Combinatorics
          </button>
          <button class="category-btn" data-category="statistics">
            <span class="category-icon">üìà</span> Statistics
          </button>
          <button class="category-btn" data-category="graph">
            <span class="category-icon">üï∏Ô∏è</span> Graph Theory
          </button>
        </div>
      </div>
      
      <!-- Center: Main Solver -->
      <div class="solver-area">
        <div class="panel">
          <h2 class="panel-title">üßÆ Symbolic Math Solver</h2>
          
          <div class="input-section">
            <label id="input-label">Enter expression or value:</label>
            <div class="input-row">
              <input type="text" id="main-input" placeholder="e.g., 2 + 3 * 4, gcd(48, 18), diff(x^2)">
            </div>
            
            <div id="extra-inputs" class="extra-inputs">
              <label id="extra-label">Additional parameters:</label>
              <div class="input-row">
                <input type="text" id="extra-input" placeholder="Variable or parameter">
              </div>
            </div>
            
            <div class="quick-ops" id="quick-ops">
              <!-- Populated by JS based on category -->
            </div>
            
            <button class="solve-btn" onclick="solve()">‚ö° Solve with Causal Trace</button>
          </div>
        </div>
        
        <div class="panel">
          <h2 class="panel-title">üìã Result</h2>
          
          <div id="status" class="status info">Ready to solve</div>
          
          <div class="result-section">
            <div class="result-title">Answer:</div>
            <div class="result-value" id="result">‚Äî</div>
          </div>
          
          <div class="result-section">
            <div class="result-title">Causal Chain (WHY this result):</div>
            <div class="causal-chain" id="causal-chain">
              <div class="causal-step">
                <span class="causal-step-number">[0]</span>
                <span class="causal-step-effect">Waiting for input...</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Right Panel: Examples -->
      <div class="panel">
        <h2 class="panel-title">üí° Examples</h2>
        <div class="examples-list" id="examples">
          <!-- Populated by JS based on category -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // SCCM MATH ENGINE (Embedded)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    class CausalChain {
      constructor(name) {
        this.name = name;
        this.links = [];
      }
      
      addLink(effect, result, reason) {
        this.links.push({ effect, result, reason });
        return result;
      }
      
      getHTML() {
        return this.links.map((link, i) => `
          <div class="causal-step">
            <span class="causal-step-number">[${i}]</span>
            <span class="causal-step-effect">${link.effect}: ${this.formatResult(link.result)}</span>
            <div class="causal-step-reason">‚Ü≥ ${link.reason}</div>
          </div>
          ${i < this.links.length - 1 ? '<div class="causal-arrow">‚Üì</div>' : ''}
        `).join('');
      }
      
      formatResult(r) {
        if (r === null || r === undefined) return '‚Äî';
        if (Array.isArray(r)) return '[' + r.join(', ') + ']';
        if (typeof r === 'object') return JSON.stringify(r);
        return String(r);
      }
    }
    
    const MathEngine = {
      // NUMBER THEORY
      isPrime(n) {
        const chain = new CausalChain('isPrime');
        chain.addLink('input', n, `Check if ${n} is prime`);
        
        if (n < 2) {
          chain.addLink('result', false, 'Numbers less than 2 are not prime by definition');
          return { result: false, chain };
        }
        
        if (n === 2) {
          chain.addLink('result', true, '2 is the only even prime');
          return { result: true, chain };
        }
        
        if (n % 2 === 0) {
          chain.addLink('divisibility', 2, `${n} is divisible by 2`);
          chain.addLink('result', false, 'Even numbers > 2 are not prime');
          return { result: false, chain };
        }
        
        const sqrtN = Math.floor(Math.sqrt(n));
        chain.addLink('search_bound', sqrtN, `Only need to check divisors up to ‚àö${n} ‚âà ${sqrtN}`);
        
        for (let i = 3; i <= sqrtN; i += 2) {
          if (n % i === 0) {
            chain.addLink('divisor_found', i, `${n} √∑ ${i} = ${n/i} (exact division)`);
            chain.addLink('result', false, `${n} has divisor ${i}, so not prime`);
            return { result: false, chain };
          }
        }
        
        chain.addLink('result', true, `No divisors found up to ${sqrtN}, so ${n} is prime`);
        return { result: true, chain };
      },
      
      gcd(a, b) {
        const chain = new CausalChain('gcd');
        chain.addLink('input', [a, b], `Compute gcd(${a}, ${b}) using Euclidean algorithm`);
        
        let origA = a, origB = b;
        let step = 1;
        
        while (b !== 0) {
          const r = a % b;
          chain.addLink(`step_${step}`, `gcd(${a}, ${b}) = gcd(${b}, ${r})`,
            `${a} = ${b} √ó ${Math.floor(a/b)} + ${r}, so gcd preserved`);
          a = b;
          b = r;
          step++;
        }
        
        chain.addLink('result', a, `When b = 0, gcd = a = ${a}`);
        return { result: a, chain };
      },
      
      factorize(n) {
        const chain = new CausalChain('factorize');
        chain.addLink('input', n, `Find prime factorization of ${n}`);
        
        const factors = [];
        let num = n;
        let d = 2;
        
        while (num > 1) {
          while (num % d === 0) {
            factors.push(d);
            chain.addLink(`factor`, d, `${num} √∑ ${d} = ${num/d}`);
            num /= d;
          }
          d++;
          if (d * d > num && num > 1) {
            factors.push(num);
            chain.addLink(`factor`, num, `${num} is prime, add directly`);
            break;
          }
        }
        
        chain.addLink('result', factors, `${n} = ${factors.join(' √ó ')}`);
        return { result: factors, chain };
      },
      
      // ARITHMETIC
      evaluate(expr) {
        const chain = new CausalChain('evaluate');
        chain.addLink('input', expr, `Evaluate expression: ${expr}`);
        
        try {
          // Safe evaluation with math functions
          const safeExpr = expr
            .replace(/\^/g, '**')
            .replace(/sin/g, 'Math.sin')
            .replace(/cos/g, 'Math.cos')
            .replace(/tan/g, 'Math.tan')
            .replace(/sqrt/g, 'Math.sqrt')
            .replace(/log/g, 'Math.log')
            .replace(/exp/g, 'Math.exp')
            .replace(/abs/g, 'Math.abs')
            .replace(/pi/gi, 'Math.PI')
            .replace(/e(?![xp])/gi, 'Math.E');
          
          chain.addLink('parse', safeExpr, `Parsed to JavaScript: ${safeExpr}`);
          
          const result = Function(`"use strict"; return (${safeExpr})`)();
          chain.addLink('result', result, `Computed via JavaScript engine`);
          
          return { result, chain };
        } catch (e) {
          chain.addLink('error', e.message, 'Evaluation failed');
          return { result: 'Error: ' + e.message, chain };
        }
      },
      
      // CALCULUS
      derivative(expr, x = 3) {
        const chain = new CausalChain('derivative');
        chain.addLink('input', expr, `Compute d/dx(${expr}) numerically at x=${x}`);
        
        const h = 1e-7;
        const f = (val) => {
          const e = expr.replace(/x/g, `(${val})`).replace(/\^/g, '**');
          return Function(`"use strict"; return (${e})`)();
        };
        
        const fxh = f(x + h);
        const fxmh = f(x - h);
        chain.addLink('f(x+h)', fxh, `f(${x + h}) = ${fxh}`);
        chain.addLink('f(x-h)', fxmh, `f(${x - h}) = ${fxmh}`);
        
        const deriv = (fxh - fxmh) / (2 * h);
        chain.addLink('result', deriv, `[f(x+h) - f(x-h)] / 2h = ${deriv}`);
        
        return { result: deriv, chain };
      },
      
      integrate(expr, a, b) {
        const chain = new CausalChain('integrate');
        chain.addLink('input', [expr, a, b], `Compute ‚à´${expr} dx from ${a} to ${b}`);
        
        const n = 1000;
        const h = (b - a) / n;
        chain.addLink('setup', { n, h }, `Using Simpson's rule with ${n} intervals, h = ${h}`);
        
        const f = (val) => {
          const e = expr.replace(/x/g, `(${val})`).replace(/\^/g, '**');
          return Function(`"use strict"; return (${e})`)();
        };
        
        let sum = f(a) + f(b);
        for (let i = 1; i < n; i++) {
          sum += (i % 2 === 0 ? 2 : 4) * f(a + i * h);
        }
        
        const result = (h / 3) * sum;
        chain.addLink('result', result, `‚à´${expr} dx from ${a} to ${b} ‚âà ${result}`);
        
        return { result, chain };
      },
      
      // LINEAR ALGEBRA
      dot(a, b) {
        const chain = new CausalChain('dot_product');
        chain.addLink('input', [a, b], `Compute dot product of vectors`);
        
        let sum = 0;
        for (let i = 0; i < a.length; i++) {
          sum += a[i] * b[i];
          chain.addLink(`component_${i}`, a[i] * b[i], `${a[i]} √ó ${b[i]} = ${a[i] * b[i]}`);
        }
        
        chain.addLink('result', sum, `Sum of products = ${sum}`);
        return { result: sum, chain };
      },
      
      matmul(A, B) {
        const chain = new CausalChain('matrix_multiply');
        chain.addLink('input', { A, B }, `Multiply matrices`);
        
        const m = A.length, n = B[0].length, k = B.length;
        const C = Array(m).fill(null).map(() => Array(n).fill(0));
        
        for (let i = 0; i < m; i++) {
          for (let j = 0; j < n; j++) {
            for (let l = 0; l < k; l++) {
              C[i][j] += A[i][l] * B[l][j];
            }
          }
        }
        
        chain.addLink('result', C, `Result matrix computed`);
        return { result: C, chain };
      },
      
      determinant(M) {
        const chain = new CausalChain('determinant');
        chain.addLink('input', M, `Compute determinant`);
        
        const n = M.length;
        if (n === 2) {
          const det = M[0][0] * M[1][1] - M[0][1] * M[1][0];
          chain.addLink('2x2_formula', det, `ad - bc = ${M[0][0]}√ó${M[1][1]} - ${M[0][1]}√ó${M[1][0]} = ${det}`);
          return { result: det, chain };
        }
        
        // Expansion by first row
        let det = 0;
        for (let j = 0; j < n; j++) {
          const minor = M.slice(1).map(row => [...row.slice(0, j), ...row.slice(j + 1)]);
          const cofactor = Math.pow(-1, j) * M[0][j] * this.determinant(minor).result;
          det += cofactor;
        }
        
        chain.addLink('result', det, `Determinant = ${det}`);
        return { result: det, chain };
      },
      
      // EQUATION SOLVING
      solveLinear(a, b) {
        const chain = new CausalChain('solve_linear');
        chain.addLink('input', `${a}x + ${b} = 0`, `Solve linear equation`);
        
        const x = -b / a;
        chain.addLink('isolate', `x = -${b} / ${a}`, `Subtract ${b}, divide by ${a}`);
        chain.addLink('result', x, `x = ${x}`);
        
        return { result: x, chain };
      },
      
      solveQuadratic(a, b, c) {
        const chain = new CausalChain('solve_quadratic');
        chain.addLink('input', `${a}x¬≤ + ${b}x + ${c} = 0`, `Solve quadratic equation`);
        
        const discriminant = b * b - 4 * a * c;
        chain.addLink('discriminant', discriminant, `Œî = b¬≤ - 4ac = ${b}¬≤ - 4√ó${a}√ó${c} = ${discriminant}`);
        
        if (discriminant < 0) {
          const real = -b / (2 * a);
          const imag = Math.sqrt(-discriminant) / (2 * a);
          chain.addLink('complex_roots', true, `Œî < 0 means complex roots`);
          chain.addLink('result', [`${real} + ${imag}i`, `${real} - ${imag}i`], `Two complex conjugate roots`);
          return { result: [`${real.toFixed(4)} + ${imag.toFixed(4)}i`, `${real.toFixed(4)} - ${imag.toFixed(4)}i`], chain };
        }
        
        const sqrtD = Math.sqrt(discriminant);
        const x1 = (-b + sqrtD) / (2 * a);
        const x2 = (-b - sqrtD) / (2 * a);
        
        chain.addLink('formula', `x = (-b ¬± ‚àöŒî) / 2a`, `Apply quadratic formula`);
        chain.addLink('result', [x1, x2], discriminant === 0 ? `One repeated root: ${x1}` : `Two roots: ${x1}, ${x2}`);
        
        return { result: discriminant === 0 ? [x1] : [x1, x2], chain };
      },
      
      // COMBINATORICS
      factorial(n) {
        const chain = new CausalChain('factorial');
        chain.addLink('input', n, `Compute ${n}!`);
        
        let result = 1;
        for (let i = 2; i <= n; i++) {
          result *= i;
        }
        
        chain.addLink('definition', `${n}! = ${n} √ó ${n-1} √ó ... √ó 2 √ó 1`, `Product of all positive integers up to ${n}`);
        chain.addLink('result', result, `${n}! = ${result}`);
        
        return { result, chain };
      },
      
      C(n, r) {
        const chain = new CausalChain('combination');
        chain.addLink('input', [n, r], `Compute C(${n}, ${r})`);
        
        if (r > n) {
          chain.addLink('result', 0, `r > n, so C(n,r) = 0`);
          return { result: 0, chain };
        }
        
        let num = 1, den = 1;
        for (let i = 0; i < r; i++) {
          num *= (n - i);
          den *= (i + 1);
        }
        
        const result = num / den;
        chain.addLink('formula', `n! / (r!(n-r)!)`, `C(n,r) = ${n}! / (${r}! √ó ${n-r}!)`);
        chain.addLink('result', result, `C(${n}, ${r}) = ${result}`);
        
        return { result, chain };
      },
      
      // STATISTICS
      mean(data) {
        const chain = new CausalChain('mean');
        chain.addLink('input', data, `Compute mean of ${data.length} values`);
        
        const sum = data.reduce((a, b) => a + b, 0);
        chain.addLink('sum', sum, `Sum = ${sum}`);
        
        const result = sum / data.length;
        chain.addLink('result', result, `Mean = ${sum} / ${data.length} = ${result}`);
        
        return { result, chain };
      },
      
      variance(data) {
        const chain = new CausalChain('variance');
        chain.addLink('input', data, `Compute variance`);
        
        const m = data.reduce((a, b) => a + b, 0) / data.length;
        chain.addLink('mean', m, `Mean = ${m}`);
        
        const sumSqDiff = data.reduce((sum, x) => sum + (x - m) ** 2, 0);
        chain.addLink('sum_squared_diff', sumSqDiff, `Œ£(x·µ¢ - Œº)¬≤ = ${sumSqDiff}`);
        
        const result = sumSqDiff / data.length;
        chain.addLink('result', result, `Variance = ${result}`);
        
        return { result, chain };
      },
      
      correlation(x, y) {
        const chain = new CausalChain('correlation');
        chain.addLink('input', { x, y }, `Compute Pearson correlation`);
        
        const n = x.length;
        const mx = x.reduce((a, b) => a + b, 0) / n;
        const my = y.reduce((a, b) => a + b, 0) / n;
        
        let num = 0, dx = 0, dy = 0;
        for (let i = 0; i < n; i++) {
          const xi = x[i] - mx, yi = y[i] - my;
          num += xi * yi;
          dx += xi * xi;
          dy += yi * yi;
        }
        
        const result = num / Math.sqrt(dx * dy);
        chain.addLink('result', result, `r = ${result.toFixed(4)}`);
        
        return { result, chain };
      }
    };
    
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    // UI LOGIC
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    
    const categories = {
      arithmetic: {
        label: 'Enter expression:',
        quickOps: ['+', '-', '*', '/', '^', 'sqrt', 'sin', 'cos'],
        examples: [
          { title: 'Basic arithmetic', code: '2 + 3 * 4' },
          { title: 'Exponentiation', code: '2^10' },
          { title: 'Square root', code: 'sqrt(144)' },
          { title: 'Trigonometry', code: 'sin(pi/2)' },
          { title: 'Check prime', code: 'isPrime(17)' },
          { title: 'GCD', code: 'gcd(48, 18)' },
          { title: 'Factorize', code: 'factorize(60)' }
        ]
      },
      algebra: {
        label: 'Enter expression:',
        quickOps: ['x', 'x^2', 'x^3', '()', 'sqrt', 'abs', 'e', 'pi'],
        examples: [
          { title: 'Polynomial', code: 'x^2 + 2*x + 1' },
          { title: 'With x=3', code: 'x=3: x^2 + 2*x + 1' },
          { title: 'Exponential', code: 'e^x, x=2' }
        ]
      },
      calculus: {
        label: 'Enter function f(x):',
        quickOps: ['diff', 'int', 'x^2', 'sin(x)', 'cos(x)', 'e^x', 'ln(x)', '1/x'],
        examples: [
          { title: 'Derivative of x¬≤', code: 'diff(x^2)' },
          { title: 'Derivative at point', code: 'diff(x^3), x=2' },
          { title: 'Definite integral', code: 'int(x^2, 0, 1)' },
          { title: 'Integral of sin', code: 'int(sin(x), 0, pi)' }
        ]
      },
      linear: {
        label: 'Enter vector/matrix:',
        quickOps: ['dot', 'cross', 'det', 'inv', 'T', 'norm', 'trace', 'rank'],
        examples: [
          { title: 'Dot product', code: 'dot([1,2,3], [4,5,6])' },
          { title: 'Cross product', code: 'cross([1,0,0], [0,1,0])' },
          { title: '2√ó2 determinant', code: 'det([[1,2],[3,4]])' },
          { title: 'Matrix multiply', code: 'matmul([[1,2],[3,4]], [[5,6],[7,8]])' }
        ]
      },
      equations: {
        label: 'Enter equation (set = 0):',
        quickOps: ['x', 'x^2', '=', '+', '-', '*', '/', 'solve'],
        examples: [
          { title: 'Linear', code: '2*x + 6 = 0' },
          { title: 'Quadratic', code: 'x^2 - 5*x + 6 = 0' },
          { title: 'With complex roots', code: 'x^2 + 1 = 0' }
        ]
      },
      combinatorics: {
        label: 'Enter combinatorial expression:',
        quickOps: ['!', 'C', 'P', 'fib', 'cat', 'bell', 'part', 'stir'],
        examples: [
          { title: 'Factorial', code: '10!' },
          { title: 'Combination', code: 'C(10, 3)' },
          { title: 'Permutation', code: 'P(5, 3)' },
          { title: 'Fibonacci', code: 'fib(10)' },
          { title: 'Catalan', code: 'catalan(5)' }
        ]
      },
      statistics: {
        label: 'Enter data as [a, b, c, ...]:',
        quickOps: ['mean', 'median', 'var', 'std', 'cor', 'reg', 'mode', 'sum'],
        examples: [
          { title: 'Mean', code: 'mean([1,2,3,4,5])' },
          { title: 'Variance', code: 'var([2,4,4,4,5,5,7,9])' },
          { title: 'Correlation', code: 'cor([1,2,3,4,5], [2,4,6,8,10])' }
        ]
      },
      graph: {
        label: 'Enter graph operation:',
        quickOps: ['bfs', 'dfs', 'dijkstra', 'mst', 'scc', 'topsort', 'flow', 'match'],
        examples: [
          { title: 'Coming soon', code: 'Graph theory operations' }
        ]
      }
    };
    
    let currentCategory = 'arithmetic';
    
    function setCategory(cat) {
      currentCategory = cat;
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.category === cat);
      });
      
      const config = categories[cat];
      document.getElementById('input-label').textContent = config.label;
      document.getElementById('main-input').placeholder = config.examples[0]?.code || '';
      
      // Update quick ops
      const quickOps = document.getElementById('quick-ops');
      quickOps.innerHTML = config.quickOps.map(op => 
        `<button class="quick-op-btn" onclick="insertOp('${op}')">${op}</button>`
      ).join('');
      
      // Update examples
      const examples = document.getElementById('examples');
      examples.innerHTML = config.examples.map(ex => `
        <div class="example-item" onclick="loadExample('${ex.code.replace(/'/g, "\\'")}')">
          <div class="example-title">${ex.title}</div>
          <div class="example-code">${ex.code}</div>
        </div>
      `).join('');
    }
    
    function insertOp(op) {
      const input = document.getElementById('main-input');
      input.value += op;
      input.focus();
    }
    
    function loadExample(code) {
      document.getElementById('main-input').value = code;
      solve();
    }
    
    function solve() {
      const input = document.getElementById('main-input').value.trim();
      if (!input) return;
      
      let result, chain;
      
      try {
        // Parse and execute
        if (input.startsWith('isPrime(')) {
          const n = parseInt(input.match(/\d+/)[0]);
          ({ result, chain } = MathEngine.isPrime(n));
        } else if (input.startsWith('gcd(')) {
          const nums = input.match(/\d+/g).map(Number);
          ({ result, chain } = MathEngine.gcd(nums[0], nums[1]));
        } else if (input.startsWith('factorize(')) {
          const n = parseInt(input.match(/\d+/)[0]);
          ({ result, chain } = MathEngine.factorize(n));
        } else if (input.startsWith('diff(')) {
          const match = input.match(/diff\((.+?)\)(?:,\s*x\s*=\s*(\d+))?/);
          const expr = match[1];
          const x = parseFloat(match[2] || '3');
          ({ result, chain } = MathEngine.derivative(expr, x));
        } else if (input.startsWith('int(')) {
          const match = input.match(/int\((.+?),\s*(\d+(?:\.\d+)?),\s*(\d+(?:\.\d+)?|pi)\)/);
          const expr = match[1];
          const a = parseFloat(match[2]);
          const b = match[3] === 'pi' ? Math.PI : parseFloat(match[3]);
          ({ result, chain } = MathEngine.integrate(expr, a, b));
        } else if (input.startsWith('dot(')) {
          const match = input.match(/\[([\d,\s]+)\].*\[([\d,\s]+)\]/);
          const a = match[1].split(',').map(Number);
          const b = match[2].split(',').map(Number);
          ({ result, chain } = MathEngine.dot(a, b));
        } else if (input.startsWith('det(')) {
          const match = input.match(/\[\[(.+)\]\]/);
          const rows = match[1].split('],[').map(r => r.replace(/[\[\]]/g, '').split(',').map(Number));
          ({ result, chain } = MathEngine.determinant(rows));
        } else if (input.includes('!') && !input.includes('=')) {
          const n = parseInt(input.match(/(\d+)!/)[1]);
          ({ result, chain } = MathEngine.factorial(n));
        } else if (input.startsWith('C(')) {
          const nums = input.match(/\d+/g).map(Number);
          ({ result, chain } = MathEngine.C(nums[0], nums[1]));
        } else if (input.startsWith('mean(')) {
          const match = input.match(/\[([\d,\s.]+)\]/);
          const data = match[1].split(',').map(Number);
          ({ result, chain } = MathEngine.mean(data));
        } else if (input.startsWith('var(')) {
          const match = input.match(/\[([\d,\s.]+)\]/);
          const data = match[1].split(',').map(Number);
          ({ result, chain } = MathEngine.variance(data));
        } else if (input.includes('x^2') && input.includes('=')) {
          // Quadratic equation
          const match = input.match(/([\d.-]*)x\^2\s*([+-]\s*[\d.]*x)?\s*([+-]\s*[\d.]+)?\s*=\s*0/);
          const a = parseFloat(match[1] || '1');
          const bMatch = match[2]?.match(/([+-]?\s*[\d.]+)/);
          const b = bMatch ? parseFloat(bMatch[1].replace(/\s/g, '')) : 0;
          const cMatch = match[3]?.match(/([+-]?\s*[\d.]+)/);
          const c = cMatch ? parseFloat(cMatch[1].replace(/\s/g, '')) : 0;
          ({ result, chain } = MathEngine.solveQuadratic(a, b, c));
        } else if (input.includes('x') && input.includes('=')) {
          // Linear equation
          const match = input.match(/([\d.-]*)x\s*([+-]\s*[\d.]+)?\s*=\s*0/);
          const a = parseFloat(match[1] || '1');
          const b = match[2] ? parseFloat(match[2].replace(/\s/g, '')) : 0;
          ({ result, chain } = MathEngine.solveLinear(a, b));
        } else {
          // General expression
          ({ result, chain } = MathEngine.evaluate(input));
        }
        
        // Display result
        document.getElementById('result').textContent = Array.isArray(result) ? result.join(', ') : result;
        document.getElementById('causal-chain').innerHTML = chain.getHTML();
        document.getElementById('status').className = 'status success';
        document.getElementById('status').textContent = '‚úì Solved successfully';
        
      } catch (e) {
        document.getElementById('result').textContent = 'Error';
        document.getElementById('status').className = 'status error';
        document.getElementById('status').textContent = '‚úó ' + e.message;
        console.error(e);
      }
    }
    
    // Initialize
    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', () => setCategory(btn.dataset.category));
    });
    
    document.getElementById('main-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') solve();
    });
    
    setCategory('arithmetic');
  </script>
</body>
</html>
