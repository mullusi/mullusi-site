<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a0f">
    <title>VIRECAI v8.3 | Cinematic Edition</title>
    
    <!-- TensorFlow.js + Models -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd@2.2.2/dist/coco-ssd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7/dist/blazeface.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@2.1.0/dist/pose-detection.min.js"></script>
    
    <style>
        :root {
            --bg-100: #05050a;
            --bg-200: #0a0a0f;
            --bg-300: #0f0f16;
            --bg-400: #14141d;
            --bg-500: #1a1a25;
            --bg-600: #22222f;
            
            --primary: #00d4ff;
            --primary-alpha: rgba(0, 212, 255, 0.15);
            --secondary: #7b61ff;
            --secondary-alpha: rgba(123, 97, 255, 0.15);
            --success: #00ff88;
            --success-alpha: rgba(0, 255, 136, 0.15);
            --warning: #ffaa00;
            --warning-alpha: rgba(255, 170, 0, 0.15);
            --danger: #ff4466;
            --danger-alpha: rgba(255, 68, 102, 0.15);
            --cyan: #00bcd4;
            --pink: #ff69b4;
            --orange: #ff8c00;
            --lime: #b4ff00;
            --gold: #ffd700;
            --cinema: #e50914;
            
            --text-100: #ffffff;
            --text-200: #e0e0e8;
            --text-300: #a0a0b0;
            --text-400: #707080;
            
            --border-100: #3a3a4a;
            --border-200: #2a2a3a;
            
            --glow-primary: 0 0 20px rgba(0, 212, 255, 0.4);
            --glow-danger: 0 0 20px rgba(255, 68, 102, 0.5);
            --glow-cinema: 0 0 20px rgba(229, 9, 20, 0.5);
            
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }
        
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        
        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-100);
            color: var(--text-100);
            height: 100%;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }
        
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: var(--bg-400); }
        ::-webkit-scrollbar-thumb { background: var(--border-100); border-radius: 3px; }
        
        .app {
            display: grid;
            grid-template-rows: auto 1fr auto auto;
            height: 100vh;
            height: 100dvh;
            padding-top: var(--safe-top);
        }
        
        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 12px;
            background: var(--bg-300);
            border-bottom: 1px solid var(--border-200);
            gap: 8px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .logo__icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--cinema), var(--orange));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
            box-shadow: var(--glow-cinema);
        }
        
        .logo__text {
            font-size: 16px;
            font-weight: 700;
            background: linear-gradient(90deg, var(--cinema), var(--orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .logo__version {
            font-size: 9px;
            color: white;
            padding: 2px 5px;
            background: linear-gradient(90deg, var(--cinema), var(--orange));
            border-radius: 4px;
            font-weight: 600;
        }
        
        .header__center {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .mode-tabs {
            display: flex;
            background: var(--bg-500);
            border-radius: 6px;
            padding: 2px;
        }
        
        .mode-tab {
            padding: 5px 10px;
            background: none;
            border: none;
            color: var(--text-400);
            font-size: 10px;
            font-weight: 500;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .mode-tab--active {
            background: var(--cinema);
            color: white;
        }
        
        .header__actions {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .badge {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 9px;
        }
        
        .badge--ai {
            background: var(--success-alpha);
            border: 1px solid var(--success);
            color: var(--success);
        }
        
        .badge--ai.loading {
            background: var(--warning-alpha);
            border-color: var(--warning);
            color: var(--warning);
        }
        
        .badge--tracking {
            background: var(--primary-alpha);
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .badge__dot {
            width: 5px;
            height: 5px;
            border-radius: 50%;
            background: currentColor;
        }
        
        .badge.loading .badge__dot {
            animation: pulse 1s infinite;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 3px 8px;
            background: var(--bg-500);
            border-radius: 10px;
            font-size: 10px;
        }
        
        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .status-dot--recording {
            background: var(--danger);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        /* Main */
        .main {
            display: flex;
            background: #000;
            overflow: hidden;
        }
        
        .viewport {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        .viewport__video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: filter 0.3s;
        }
        
        .viewport__video--mirrored { transform: scaleX(-1); }
        .viewport__video.hidden { display: none; }
        
        /* Chroma key canvas */
        .viewport__chroma {
            position: absolute;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            pointer-events: none;
        }
        
        .viewport__chroma.hidden { display: none; }
        
        .viewport__placeholder {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--bg-300);
            gap: 12px;
        }
        
        .viewport__placeholder.hidden { display: none; }
        .viewport__placeholder-icon { font-size: 48px; opacity: 0.5; }
        
        /* Overlays */
        .overlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }
        
        /* Tracking box */
        .tracking-box {
            position: absolute;
            border: 2px solid var(--lime);
            border-radius: 3px;
            background: rgba(180, 255, 0, 0.1);
        }
        
        .tracking-box__label {
            position: absolute;
            top: -18px;
            left: 0;
            padding: 2px 6px;
            background: var(--lime);
            color: var(--bg-100);
            font-size: 9px;
            font-weight: 600;
            border-radius: 2px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .tracking-box__trail {
            position: absolute;
            pointer-events: none;
        }
        
        .trail-point {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--lime);
            border-radius: 50%;
        }
        
        .detection-box {
            position: absolute;
            border: 2px solid var(--primary);
            border-radius: 3px;
        }
        
        .detection-box--face { border-color: var(--secondary); }
        
        .detection-box__label {
            position: absolute;
            top: -16px;
            left: 0;
            padding: 1px 4px;
            background: var(--primary);
            color: var(--bg-100);
            font-size: 8px;
            font-weight: 600;
            border-radius: 2px;
        }
        
        .detection-box--face .detection-box__label { background: var(--secondary); }
        
        /* Animated titles */
        .title-overlay {
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none;
            text-align: center;
        }
        
        .title-text {
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation-fill-mode: both;
        }
        
        /* Title animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes typewriter { from { width: 0; } to { width: 100%; } }
        @keyframes zoomIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
        }
        
        /* Float panels */
        .float-panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            border-radius: 8px;
            border: 1px solid var(--border-200);
            padding: 6px 8px;
            z-index: 10;
        }
        
        .float-panel--tl { top: 8px; left: 8px; }
        .float-panel--tr { top: 8px; right: 8px; }
        .float-panel--bl { bottom: 8px; left: 8px; }
        .float-panel--br { bottom: 8px; right: 8px; }
        
        .float-panel__label {
            font-size: 8px;
            font-weight: 600;
            color: var(--text-400);
            text-transform: uppercase;
        }
        
        .float-panel__value {
            font-size: 16px;
            font-weight: 700;
            font-family: 'SF Mono', monospace;
        }
        
        .float-panel__unit { font-size: 9px; color: var(--text-300); }
        
        /* Sidebar */
        .sidebar {
            width: 320px;
            background: var(--bg-300);
            border-left: 1px solid var(--border-200);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        @media (max-width: 900px) { .sidebar { width: 280px; } }
        @media (max-width: 700px) { .sidebar { display: none; } }
        
        .sidebar__tabs {
            display: flex;
            background: var(--bg-400);
            flex-wrap: wrap;
        }
        
        .sidebar__tab {
            flex: 1;
            min-width: 40px;
            padding: 8px 4px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            color: var(--text-400);
            font-size: 12px;
            cursor: pointer;
        }
        
        .sidebar__tab--active {
            color: var(--cinema);
            border-bottom-color: var(--cinema);
        }
        
        .sidebar__content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .sidebar__panel { display: none; }
        .sidebar__panel--active { display: block; }
        
        .panel-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-300);
            text-transform: uppercase;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .panel-title__badge {
            padding: 1px 4px;
            background: var(--cinema);
            border-radius: 3px;
            font-size: 8px;
            color: white;
        }
        
        /* Tracking targets */
        .tracking-targets {
            display: flex;
            flex-direction: column;
            gap: 6px;
            margin-bottom: 12px;
        }
        
        .tracking-target {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: var(--bg-400);
            border: 2px solid var(--border-200);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .tracking-target:hover { border-color: var(--lime); }
        .tracking-target--active { border-color: var(--lime); background: rgba(180, 255, 0, 0.1); }
        
        .tracking-target__icon {
            width: 32px;
            height: 32px;
            background: var(--bg-500);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .tracking-target__info { flex: 1; }
        .tracking-target__name { font-size: 11px; font-weight: 600; }
        .tracking-target__status { font-size: 9px; color: var(--text-400); }
        
        .tracking-target__lock {
            width: 24px;
            height: 24px;
            background: var(--bg-600);
            border: none;
            border-radius: 4px;
            color: var(--text-400);
            font-size: 12px;
            cursor: pointer;
        }
        
        .tracking-target__lock--locked {
            background: var(--lime);
            color: var(--bg-100);
        }
        
        /* LUT presets */
        .lut-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            margin-bottom: 12px;
        }
        
        .lut-preset {
            aspect-ratio: 16/9;
            background: var(--bg-400);
            border: 2px solid var(--border-200);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.15s;
        }
        
        .lut-preset:hover { border-color: var(--cinema); }
        .lut-preset--active { border-color: var(--cinema); }
        
        .lut-preset__preview {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        .lut-preset__name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 2px;
            background: rgba(0,0,0,0.8);
            font-size: 8px;
            text-align: center;
        }
        
        /* Title editor */
        .title-editor {
            background: var(--bg-400);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 12px;
        }
        
        .title-input {
            width: 100%;
            padding: 8px;
            background: var(--bg-500);
            border: 1px solid var(--border-200);
            border-radius: 4px;
            color: var(--text-100);
            font-size: 12px;
            margin-bottom: 8px;
        }
        
        .title-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }
        
        .title-option {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }
        
        .title-option__label {
            font-size: 8px;
            color: var(--text-400);
            text-transform: uppercase;
        }
        
        .title-select {
            padding: 4px 6px;
            background: var(--bg-500);
            border: 1px solid var(--border-200);
            border-radius: 3px;
            color: var(--text-100);
            font-size: 10px;
        }
        
        .title-animations {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 8px;
        }
        
        .title-anim-btn {
            padding: 4px 8px;
            background: var(--bg-500);
            border: 1px solid var(--border-200);
            border-radius: 3px;
            color: var(--text-200);
            font-size: 9px;
            cursor: pointer;
        }
        
        .title-anim-btn--active {
            border-color: var(--cinema);
            background: rgba(229, 9, 20, 0.2);
            color: var(--cinema);
        }
        
        /* Chroma key */
        .chroma-controls {
            background: var(--bg-400);
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 12px;
        }
        
        .chroma-color-picker {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .chroma-color-btn {
            width: 32px;
            height: 32px;
            border-radius: 4px;
            border: 2px solid var(--border-200);
            cursor: pointer;
        }
        
        .chroma-color-btn--active { border-color: var(--text-100); }
        .chroma-color-btn--green { background: #00ff00; }
        .chroma-color-btn--blue { background: #0000ff; }
        .chroma-color-btn--custom { background: linear-gradient(45deg, #ff0000, #00ff00, #0000ff); }
        
        .chroma-slider-group {
            margin-bottom: 8px;
        }
        
        .chroma-slider-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2px;
        }
        
        .chroma-slider-label { font-size: 9px; color: var(--text-300); }
        .chroma-slider-value { font-size: 9px; font-family: monospace; color: var(--success); }
        
        .chroma-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: var(--bg-500);
            border-radius: 2px;
        }
        
        .chroma-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: var(--success);
            border-radius: 50%;
            cursor: pointer;
        }
        
        /* Storyboard */
        .storyboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .storyboard-card {
            background: var(--bg-400);
            border: 1px solid var(--border-200);
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .storyboard-card:hover { border-color: var(--cinema); }
        .storyboard-card--active { border-color: var(--cinema); background: var(--bg-500); }
        
        .storyboard-card__thumb {
            aspect-ratio: 16/9;
            background: var(--bg-600);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            position: relative;
        }
        
        .storyboard-card__number {
            position: absolute;
            top: 4px;
            left: 4px;
            background: var(--cinema);
            color: white;
            font-size: 9px;
            font-weight: 700;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .storyboard-card__duration {
            position: absolute;
            bottom: 4px;
            right: 4px;
            background: rgba(0,0,0,0.8);
            color: white;
            font-size: 9px;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .storyboard-card__info {
            padding: 6px;
        }
        
        .storyboard-card__title {
            font-size: 10px;
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .storyboard-card__meta {
            font-size: 8px;
            color: var(--text-400);
        }
        
        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
            margin-bottom: 12px;
        }
        
        .stat-card {
            background: var(--bg-400);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
        }
        
        .stat-card__label {
            font-size: 8px;
            color: var(--text-400);
            text-transform: uppercase;
        }
        
        .stat-card__value { font-size: 18px; font-weight: 700; }
        
        /* AI Model list */
        .ai-models {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .ai-model {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: var(--bg-400);
            border: 1px solid var(--border-200);
            border-radius: 6px;
        }
        
        .ai-model--active { border-color: var(--success); }
        
        .ai-model__icon {
            width: 28px;
            height: 28px;
            background: var(--bg-500);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .ai-model__info { flex: 1; }
        .ai-model__name { font-size: 11px; font-weight: 600; }
        .ai-model__status { font-size: 9px; color: var(--text-400); }
        
        .ai-model__toggle {
            width: 32px;
            height: 18px;
            background: var(--bg-600);
            border: none;
            border-radius: 9px;
            cursor: pointer;
            position: relative;
        }
        
        .ai-model__toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 14px;
            height: 14px;
            background: var(--text-300);
            border-radius: 50%;
            transition: all 0.2s;
        }
        
        .ai-model__toggle--on { background: var(--cinema); }
        .ai-model__toggle--on::after { left: 16px; background: white; }
        
        /* Timeline */
        .timeline-container {
            background: var(--bg-300);
            border-top: 1px solid var(--border-200);
            padding: 6px 10px;
        }
        
        .timeline-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            flex-wrap: wrap;
        }
        
        .time-display {
            font-family: 'SF Mono', monospace;
            font-size: 11px;
            color: var(--text-200);
            min-width: 100px;
        }
        
        .playback-controls {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .timeline-actions {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-left: auto;
        }
        
        /* Multi-track timeline */
        .multi-timeline {
            display: flex;
            flex-direction: column;
            gap: 2px;
            background: var(--bg-400);
            border-radius: 5px;
            padding: 4px;
        }
        
        .timeline-track {
            display: flex;
            align-items: center;
            gap: 4px;
            height: 22px;
        }
        
        .timeline-track__label {
            width: 60px;
            font-size: 8px;
            font-weight: 600;
            color: var(--text-400);
            text-transform: uppercase;
        }
        
        .timeline-track__content {
            flex: 1;
            height: 100%;
            background: var(--bg-500);
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }
        
        .timeline-track__fill {
            position: absolute;
            top: 2px;
            bottom: 2px;
            left: 0;
            border-radius: 2px;
        }
        
        .timeline-track--video .timeline-track__fill { background: var(--primary); }
        .timeline-track--tracking .timeline-track__fill { background: var(--lime); }
        .timeline-track--titles .timeline-track__fill { background: var(--cinema); }
        .timeline-track--lut .timeline-track__fill { background: var(--orange); }
        
        .timeline-cursor {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--text-100);
            z-index: 5;
        }
        
        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 6px 12px;
            background: var(--cinema);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
        }
        
        .btn:hover { filter: brightness(1.1); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn--secondary {
            background: var(--bg-500);
            color: var(--text-100);
            border: 1px solid var(--border-200);
        }
        
        .btn--icon {
            width: 28px;
            height: 28px;
            padding: 0;
            border-radius: 50%;
            font-size: 12px;
        }
        
        .btn--sm { padding: 4px 8px; font-size: 9px; }
        
        .btn--record {
            width: 38px;
            height: 38px;
            background: var(--danger);
            border: 2px solid var(--text-100);
            box-shadow: var(--glow-danger);
        }
        
        .btn--record.recording {
            border-radius: 6px;
            background: var(--text-100);
        }
        
        .btn--record.recording::after {
            content: '';
            width: 12px;
            height: 12px;
            background: var(--danger);
            border-radius: 2px;
        }
        
        .speed-select {
            background: var(--bg-500);
            border: 1px solid var(--border-200);
            border-radius: 4px;
            padding: 4px 6px;
            color: var(--text-100);
            font-size: 10px;
        }
        
        /* Toolbar */
        .toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 10px;
            background: var(--bg-400);
            border-top: 1px solid var(--border-200);
            padding-bottom: calc(6px + var(--safe-bottom));
            gap: 6px;
        }
        
        .toolbar__group {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Toast */
        .toast-container {
            position: fixed;
            top: 50px;
            right: 8px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .toast {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--bg-400);
            border: 1px solid var(--border-200);
            border-radius: 6px;
            font-size: 11px;
            animation: toastIn 0.3s ease;
        }
        
        .toast--success { border-left: 3px solid var(--success); }
        .toast--warning { border-left: 3px solid var(--warning); }
        .toast--error { border-left: 3px solid var(--danger); }
        .toast--info { border-left: 3px solid var(--primary); }
        .toast--cinema { border-left: 3px solid var(--cinema); }
        
        @keyframes toastIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="toast-container" id="toastContainer"></div>
    
    <div class="app">
        <header class="header">
            <div class="logo">
                <div class="logo__icon">V</div>
                <span class="logo__text">VIRECAI</span>
                <span class="logo__version">v8.3 CINEMA</span>
            </div>
            
            <div class="header__center">
                <div class="mode-tabs">
                    <button class="mode-tab mode-tab--active" data-mode="capture">Capture</button>
                    <button class="mode-tab" data-mode="edit">Edit</button>
                    <button class="mode-tab" data-mode="storyboard">Storyboard</button>
                    <button class="mode-tab" data-mode="play">Play</button>
                </div>
            </div>
            
            <div class="header__actions">
                <div class="badge badge--tracking" id="trackingBadge">
                    <span class="badge__dot"></span>
                    <span id="trackingCount">0 tracking</span>
                </div>
                <div class="badge badge--ai loading" id="aiBadge">
                    <span class="badge__dot"></span>
                    <span id="aiStatus">0/3</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Ready</span>
                </div>
            </div>
        </header>
        
        <main class="main">
            <div class="viewport" id="viewport">
                <video class="viewport__video" id="video" autoplay playsinline muted></video>
                <video class="viewport__video hidden" id="playbackVideo" playsinline></video>
                <canvas class="viewport__chroma hidden" id="chromaCanvas"></canvas>
                
                <div class="viewport__placeholder" id="placeholder">
                    <div class="viewport__placeholder-icon">üé¨</div>
                    <div id="placeholderText">Cinematic Edition</div>
                    <button class="btn" onclick="requestCamera()">Start Production</button>
                </div>
                
                <div class="overlay" id="detectionOverlay"></div>
                <div class="overlay" id="trackingOverlay"></div>
                <div class="overlay" id="titleOverlay"></div>
                <canvas class="overlay" id="poseCanvas"></canvas>
                
                <div class="float-panel float-panel--tl">
                    <div class="float-panel__label">Duration</div>
                    <div class="float-panel__value" id="timeDisplay">0:00<span class="float-panel__unit">.00</span></div>
                </div>
                
                <div class="float-panel float-panel--tr">
                    <div class="float-panel__label">LUT</div>
                    <div class="float-panel__value" style="font-size:12px" id="lutName">None</div>
                </div>
                
                <div class="float-panel float-panel--bl">
                    <div class="float-panel__label">Tracking</div>
                    <div class="float-panel__value"><span id="trackingValue">0</span></div>
                </div>
                
                <div class="float-panel float-panel--br">
                    <div class="float-panel__label">Scene</div>
                    <div class="float-panel__value"><span id="sceneValue">1</span></div>
                </div>
            </div>
            
            <aside class="sidebar">
                <div class="sidebar__tabs">
                    <button class="sidebar__tab sidebar__tab--active" data-tab="tracking" onclick="switchTab('tracking')">üéØ</button>
                    <button class="sidebar__tab" data-tab="lut" onclick="switchTab('lut')">üé®</button>
                    <button class="sidebar__tab" data-tab="titles" onclick="switchTab('titles')">üìù</button>
                    <button class="sidebar__tab" data-tab="chroma" onclick="switchTab('chroma')">üü¢</button>
                    <button class="sidebar__tab" data-tab="storyboard" onclick="switchTab('storyboard')">üìã</button>
                    <button class="sidebar__tab" data-tab="ai" onclick="switchTab('ai')">üß†</button>
                </div>
                
                <div class="sidebar__content">
                    <!-- Tracking Panel -->
                    <div class="sidebar__panel sidebar__panel--active" id="trackingPanel">
                        <div class="panel-title">üéØ Object Tracking <span class="panel-title__badge">AI</span></div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-card__label">Tracked</div>
                                <div class="stat-card__value" id="trackedCount">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card__label">Locked</div>
                                <div class="stat-card__value" id="lockedCount">0</div>
                            </div>
                        </div>
                        
                        <div class="panel-title">Detected Objects</div>
                        <div class="tracking-targets" id="trackingTargets">
                            <div style="color:var(--text-400);font-size:10px;text-align:center;padding:15px">
                                Objects will appear here
                            </div>
                        </div>
                        
                        <button class="btn btn--secondary" style="width:100%" onclick="clearTracking()">
                            Clear All Tracking
                        </button>
                    </div>
                    
                    <!-- LUT Panel -->
                    <div class="sidebar__panel" id="lutPanel">
                        <div class="panel-title">üé® Color LUTs <span class="panel-title__badge">CINEMA</span></div>
                        
                        <div class="lut-grid" id="lutGrid">
                            <div class="lut-preset lut-preset--active" onclick="setLUT('none')" data-lut="none">
                                <div class="lut-preset__preview">‚ö™</div>
                                <div class="lut-preset__name">None</div>
                            </div>
                            <div class="lut-preset" onclick="setLUT('teal-orange')" data-lut="teal-orange">
                                <div class="lut-preset__preview" style="background:linear-gradient(135deg,#008080,#ff8c00)">üé¨</div>
                                <div class="lut-preset__name">Teal/Orange</div>
                            </div>
                            <div class="lut-preset" onclick="setLUT('cinematic')" data-lut="cinematic">
                                <div class="lut-preset__preview" style="background:linear-gradient(135deg,#1a1a2e,#e94560)">üé•</div>
                                <div class="lut-preset__name">Cinematic</div>
                            </div>
                            <div class="lut-preset" onclick="setLUT('noir')" data-lut="noir">
                                <div class="lut-preset__preview" style="background:#333">üñ§</div>
                                <div class="lut-preset__name">Film Noir</div>
                            </div>
                            <div class="lut-preset" onclick="setLUT('vintage')" data-lut="vintage">
                                <div class="lut-preset__preview" style="background:linear-gradient(135deg,#d4a574,#8b7355)">üì∑</div>
                                <div class="lut-preset__name">Vintage</div>
                            </div>
                            <div class="lut-preset" onclick="setLUT('cyberpunk')" data-lut="cyberpunk">
                                <div class="lut-preset__preview" style="background:linear-gradient(135deg,#ff00ff,#00ffff)">üåÜ</div>
                                <div class="lut-preset__name">Cyberpunk</div>
                            </div>
                            <div class="lut-preset" onclick="setLUT('bleach')" data-lut="bleach">
                                <div class="lut-preset__preview" style="background:#e8e8e8">‚òÄÔ∏è</div>
                                <div class="lut-preset__name">Bleach Bypass</div>
                            </div>
                            <div class="lut-preset" onclick="setLUT('golden')" data-lut="golden">
                                <div class="lut-preset__preview" style="background:linear-gradient(135deg,#ffd700,#ff8c00)">üåÖ</div>
                                <div class="lut-preset__name">Golden Hour</div>
                            </div>
                            <div class="lut-preset" onclick="setLUT('moody')" data-lut="moody">
                                <div class="lut-preset__preview" style="background:linear-gradient(135deg,#2c3e50,#4a69bd)">üåô</div>
                                <div class="lut-preset__name">Moody Blue</div>
                            </div>
                        </div>
                        
                        <div class="panel-title">Intensity</div>
                        <input type="range" class="chroma-slider" id="lutIntensity" min="0" max="100" value="100" oninput="updateLUTIntensity()">
                    </div>
                    
                    <!-- Titles Panel -->
                    <div class="sidebar__panel" id="titlesPanel">
                        <div class="panel-title">üìù Animated Titles</div>
                        
                        <div class="title-editor">
                            <input type="text" class="title-input" id="titleText" placeholder="Enter title text..." value="VIRECAI">
                            
                            <div class="title-options">
                                <div class="title-option">
                                    <span class="title-option__label">Font Size</span>
                                    <select class="title-select" id="titleSize">
                                        <option value="24">Small</option>
                                        <option value="36">Medium</option>
                                        <option value="48" selected>Large</option>
                                        <option value="72">XL</option>
                                        <option value="96">XXL</option>
                                    </select>
                                </div>
                                <div class="title-option">
                                    <span class="title-option__label">Position</span>
                                    <select class="title-select" id="titlePosition">
                                        <option value="top">Top</option>
                                        <option value="center" selected>Center</option>
                                        <option value="bottom">Bottom</option>
                                        <option value="lower-third">Lower Third</option>
                                    </select>
                                </div>
                                <div class="title-option">
                                    <span class="title-option__label">Color</span>
                                    <input type="color" class="title-select" id="titleColor" value="#ffffff" style="padding:2px;height:24px">
                                </div>
                                <div class="title-option">
                                    <span class="title-option__label">Duration</span>
                                    <select class="title-select" id="titleDuration">
                                        <option value="2">2s</option>
                                        <option value="3" selected>3s</option>
                                        <option value="5">5s</option>
                                        <option value="0">Infinite</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="panel-title" style="margin-top:10px;margin-bottom:4px">Animation</div>
                            <div class="title-animations">
                                <button class="title-anim-btn title-anim-btn--active" onclick="setTitleAnim('fadeIn')">Fade In</button>
                                <button class="title-anim-btn" onclick="setTitleAnim('slideUp')">Slide Up</button>
                                <button class="title-anim-btn" onclick="setTitleAnim('slideDown')">Slide Down</button>
                                <button class="title-anim-btn" onclick="setTitleAnim('zoomIn')">Zoom</button>
                                <button class="title-anim-btn" onclick="setTitleAnim('typewriter')">Typewriter</button>
                                <button class="title-anim-btn" onclick="setTitleAnim('glitch')">Glitch</button>
                            </div>
                        </div>
                        
                        <button class="btn" style="width:100%" onclick="addTitle()">
                            + Add Title to Timeline
                        </button>
                        
                        <button class="btn btn--secondary" style="width:100%;margin-top:6px" onclick="previewTitle()">
                            üëÅÔ∏è Preview Title
                        </button>
                    </div>
                    
                    <!-- Chroma Panel -->
                    <div class="sidebar__panel" id="chromaPanel">
                        <div class="panel-title">üü¢ Chroma Key</div>
                        
                        <div class="chroma-controls">
                            <div class="panel-title" style="margin-bottom:6px">Key Color</div>
                            <div class="chroma-color-picker">
                                <button class="chroma-color-btn chroma-color-btn--green chroma-color-btn--active" onclick="setChromaColor('green')" data-color="green"></button>
                                <button class="chroma-color-btn chroma-color-btn--blue" onclick="setChromaColor('blue')" data-color="blue"></button>
                                <button class="chroma-color-btn chroma-color-btn--custom" onclick="pickChromaColor()" data-color="custom"></button>
                                <input type="color" id="chromaColorPicker" style="display:none" onchange="setCustomChromaColor()">
                            </div>
                            
                            <div class="chroma-slider-group">
                                <div class="chroma-slider-header">
                                    <span class="chroma-slider-label">Threshold</span>
                                    <span class="chroma-slider-value" id="chromaThreshVal">40</span>
                                </div>
                                <input type="range" class="chroma-slider" id="chromaThreshold" min="10" max="100" value="40" oninput="updateChroma()">
                            </div>
                            
                            <div class="chroma-slider-group">
                                <div class="chroma-slider-header">
                                    <span class="chroma-slider-label">Smoothing</span>
                                    <span class="chroma-slider-value" id="chromaSmoothVal">5</span>
                                </div>
                                <input type="range" class="chroma-slider" id="chromaSmoothing" min="0" max="20" value="5" oninput="updateChroma()">
                            </div>
                            
                            <div class="chroma-slider-group">
                                <div class="chroma-slider-header">
                                    <span class="chroma-slider-label">Spill Suppression</span>
                                    <span class="chroma-slider-value" id="chromaSpillVal">50</span>
                                </div>
                                <input type="range" class="chroma-slider" id="chromaSpill" min="0" max="100" value="50" oninput="updateChroma()">
                            </div>
                        </div>
                        
                        <div class="panel-title">Background</div>
                        <div class="lut-grid" style="grid-template-columns: repeat(4, 1fr)">
                            <div class="lut-preset" onclick="setChromaBg('transparent')" style="background:repeating-conic-gradient(#666 0 25%, #999 0 50%) 0 0/10px 10px">
                                <div class="lut-preset__name">None</div>
                            </div>
                            <div class="lut-preset" onclick="setChromaBg('blur')">
                                <div class="lut-preset__preview">üå´Ô∏è</div>
                                <div class="lut-preset__name">Blur</div>
                            </div>
                            <div class="lut-preset" onclick="setChromaBg('image')">
                                <div class="lut-preset__preview">üñºÔ∏è</div>
                                <div class="lut-preset__name">Image</div>
                            </div>
                            <div class="lut-preset" onclick="setChromaBg('video')">
                                <div class="lut-preset__preview">üé¨</div>
                                <div class="lut-preset__name">Video</div>
                            </div>
                        </div>
                        
                        <button class="btn" style="width:100%;margin-top:10px" onclick="toggleChroma()">
                            <span id="chromaToggleText">Enable Chroma Key</span>
                        </button>
                    </div>
                    
                    <!-- Storyboard Panel -->
                    <div class="sidebar__panel" id="storyboardPanel">
                        <div class="panel-title">üìã Storyboard View</div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-card__label">Scenes</div>
                                <div class="stat-card__value" id="storyScenes">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card__label">Duration</div>
                                <div class="stat-card__value" id="storyDuration">0:00</div>
                            </div>
                        </div>
                        
                        <div class="storyboard" id="storyboardGrid">
                            <div style="color:var(--text-400);font-size:10px;text-align:center;padding:30px;grid-column:span 2">
                                Record to generate storyboard
                            </div>
                        </div>
                        
                        <button class="btn btn--secondary" style="width:100%;margin-top:10px" onclick="regenerateStoryboard()">
                            üîÑ Regenerate Storyboard
                        </button>
                    </div>
                    
                    <!-- AI Panel -->
                    <div class="sidebar__panel" id="aiPanel">
                        <div class="panel-title">üß† AI Models</div>
                        <div class="ai-models">
                            <div class="ai-model ai-model--active" id="cocoModel">
                                <div class="ai-model__icon">üéØ</div>
                                <div class="ai-model__info">
                                    <div class="ai-model__name">COCO-SSD</div>
                                    <div class="ai-model__status" id="cocoStatus">Loading...</div>
                                </div>
                                <button class="ai-model__toggle ai-model__toggle--on" id="cocoToggle" onclick="toggleModel('coco')"></button>
                            </div>
                            <div class="ai-model" id="blazefaceModel">
                                <div class="ai-model__icon">üë§</div>
                                <div class="ai-model__info">
                                    <div class="ai-model__name">BlazeFace</div>
                                    <div class="ai-model__status" id="blazefaceStatus">Loading...</div>
                                </div>
                                <button class="ai-model__toggle ai-model__toggle--on" id="blazefaceToggle" onclick="toggleModel('blazeface')"></button>
                            </div>
                            <div class="ai-model" id="movenetModel">
                                <div class="ai-model__icon">üèÉ</div>
                                <div class="ai-model__info">
                                    <div class="ai-model__name">MoveNet</div>
                                    <div class="ai-model__status" id="movenetStatus">Loading...</div>
                                </div>
                                <button class="ai-model__toggle ai-model__toggle--on" id="movenetToggle" onclick="toggleModel('movenet')"></button>
                            </div>
                        </div>
                        
                        <div class="panel-title" style="margin-top:12px">Detection Stats</div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-card__label">Objects</div>
                                <div class="stat-card__value" id="objectCount">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-card__label">Faces</div>
                                <div class="stat-card__value" id="faceCount">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>
        
        <!-- Timeline -->
        <div class="timeline-container">
            <div class="timeline-controls">
                <div class="time-display">
                    <span id="currentTime">0:00.00</span> / <span id="totalTime">0:00.00</span>
                </div>
                
                <div class="playback-controls">
                    <button class="btn btn--secondary btn--icon" onclick="jumpBack()">‚è™</button>
                    <button class="btn btn--record" id="recordBtn" onclick="toggleRecording()"></button>
                    <button class="btn btn--secondary btn--icon" id="playBtn" onclick="togglePlayback()">‚ñ∂Ô∏è</button>
                    <button class="btn btn--secondary btn--icon" onclick="jumpForward()">‚è©</button>
                </div>
                
                <div class="timeline-actions">
                    <select class="speed-select" id="speedSelect" onchange="setSpeed()">
                        <option value="0.5">0.5x</option>
                        <option value="1" selected>1x</option>
                        <option value="1.5">1.5x</option>
                        <option value="2">2x</option>
                    </select>
                    <button class="btn btn--secondary btn--icon" onclick="switchCamera()">üîÑ</button>
                </div>
            </div>
            
            <div class="multi-timeline">
                <div class="timeline-track timeline-track--video">
                    <div class="timeline-track__label">üé¨ Video</div>
                    <div class="timeline-track__content">
                        <div class="timeline-track__fill" id="videoTrackFill" style="width:0%"></div>
                        <div class="timeline-cursor" id="videoCursor"></div>
                    </div>
                </div>
                <div class="timeline-track timeline-track--tracking">
                    <div class="timeline-track__label">üéØ Track</div>
                    <div class="timeline-track__content" id="trackingTrackContent"></div>
                </div>
                <div class="timeline-track timeline-track--titles">
                    <div class="timeline-track__label">üìù Titles</div>
                    <div class="timeline-track__content" id="titlesTrackContent"></div>
                </div>
                <div class="timeline-track timeline-track--lut">
                    <div class="timeline-track__label">üé® LUT</div>
                    <div class="timeline-track__content">
                        <div class="timeline-track__fill" id="lutTrackFill" style="width:0%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="toolbar">
            <div class="toolbar__group">
                <button class="btn btn--secondary btn--icon" onclick="undo()">‚Ü©Ô∏è</button>
                <button class="btn btn--secondary btn--icon" onclick="redo()">‚Ü™Ô∏è</button>
            </div>
            
            <div class="toolbar__group">
                <button class="btn btn--secondary btn--icon" onclick="exportCapsule()">üì¶</button>
                <button class="btn" onclick="exportVideo()">üé¨ Export</button>
            </div>
        </div>
    </div>

    <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // VIRECAI v8.3 CINEMATIC EDITION
        // Object Tracking, LUT Grading, Animated Titles, Chroma Key, Storyboard
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const VERSION = '8.3.0';
        const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        
        console.log(`%cVIRECAI v${VERSION} CINEMATIC`, 'color:#e50914;font-size:20px;font-weight:bold');
        
        const $ = id => document.getElementById(id);
        const $$ = sel => document.querySelectorAll(sel);
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // STATE
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const state = {
            isRecording: false,
            isPlaying: false,
            cameraReady: false,
            facingMode: 'user',
            
            stream: null,
            mediaRecorder: null,
            recordedChunks: [],
            recordedBlob: null,
            recordedUrl: null,
            
            // AI
            models: {
                coco: { instance: null, ready: false, enabled: true },
                blazeface: { instance: null, ready: false, enabled: true },
                movenet: { instance: null, ready: false, enabled: true }
            },
            
            objects: [],
            faces: [],
            poses: [],
            
            // Tracking
            trackedObjects: [],
            trackingHistory: {},
            
            // LUT
            currentLUT: 'none',
            lutIntensity: 100,
            
            // Titles
            titles: [],
            titleConfig: {
                text: 'VIRECAI',
                size: 48,
                position: 'center',
                color: '#ffffff',
                duration: 3,
                animation: 'fadeIn'
            },
            
            // Chroma
            chromaEnabled: false,
            chromaColor: { r: 0, g: 255, b: 0 },
            chromaThreshold: 40,
            chromaSmoothing: 5,
            chromaSpill: 50,
            chromaBg: 'transparent',
            
            // Scenes
            scenes: [],
            currentScene: 1,
            
            // Time
            startTime: 0,
            currentTime: 0,
            frameCount: 0,
            duration: 60000
        };
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // TOAST
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function toast(msg, type = 'info') {
            const el = document.createElement('div');
            el.className = `toast toast--${type}`;
            el.textContent = msg;
            $('toastContainer').appendChild(el);
            setTimeout(() => el.remove(), 3000);
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // AI MODELS
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function loadAIModels() {
            let loaded = 0;
            const update = () => {
                $('aiStatus').textContent = `${loaded}/3`;
                if (loaded === 3) $('aiBadge').classList.remove('loading');
            };
            
            try {
                $('cocoStatus').textContent = 'Loading...';
                state.models.coco.instance = await cocoSsd.load();
                state.models.coco.ready = true;
                $('cocoStatus').textContent = '80 classes';
                $('cocoModel').classList.add('ai-model--active');
                loaded++; update();
            } catch (e) { $('cocoStatus').textContent = 'Failed'; loaded++; update(); }
            
            try {
                $('blazefaceStatus').textContent = 'Loading...';
                state.models.blazeface.instance = await blazeface.load();
                state.models.blazeface.ready = true;
                $('blazefaceStatus').textContent = '6 landmarks';
                $('blazefaceModel').classList.add('ai-model--active');
                loaded++; update();
            } catch (e) { $('blazefaceStatus').textContent = 'Failed'; loaded++; update(); }
            
            try {
                $('movenetStatus').textContent = 'Loading...';
                state.models.movenet.instance = await poseDetection.createDetector(
                    poseDetection.SupportedModels.MoveNet,
                    { modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING }
                );
                state.models.movenet.ready = true;
                $('movenetStatus').textContent = '17 keypoints';
                $('movenetModel').classList.add('ai-model--active');
                loaded++; update();
            } catch (e) { $('movenetStatus').textContent = 'Failed'; loaded++; update(); }
            
            toast(`${loaded} AI models loaded`, 'success');
        }
        
        function toggleModel(name) {
            state.models[name].enabled = !state.models[name].enabled;
            $(`${name}Toggle`).classList.toggle('ai-model__toggle--on', state.models[name].enabled);
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // AI DETECTION & TRACKING
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function runAIDetection() {
            if (!state.cameraReady) return;
            const video = $('video');
            if (video.readyState < 2) return;
            
            if (state.models.coco.ready && state.models.coco.enabled) {
                try { 
                    state.objects = await state.models.coco.instance.detect(video);
                    updateTracking();
                } catch (e) {}
            }
            
            if (state.models.blazeface.ready && state.models.blazeface.enabled) {
                try { state.faces = await state.models.blazeface.instance.estimateFaces(video, false); } catch (e) {}
            }
            
            if (state.models.movenet.ready && state.models.movenet.enabled) {
                try { state.poses = await state.models.movenet.instance.estimatePoses(video); } catch (e) {}
            }
            
            $('objectCount').textContent = state.objects.length;
            $('faceCount').textContent = state.faces.length;
            
            renderDetections();
            renderTracking();
            updateTrackingTargets();
        }
        
        function updateTracking() {
            // Match detected objects with tracked objects
            state.objects.forEach(obj => {
                const tracked = state.trackedObjects.find(t => 
                    t.class === obj.class && t.locked
                );
                
                if (tracked) {
                    // Update position
                    const [x, y, w, h] = obj.bbox;
                    tracked.bbox = obj.bbox;
                    tracked.lastSeen = state.currentTime;
                    
                    // Add to history
                    if (!state.trackingHistory[tracked.id]) {
                        state.trackingHistory[tracked.id] = [];
                    }
                    state.trackingHistory[tracked.id].push({
                        time: state.currentTime,
                        x: x + w/2,
                        y: y + h/2
                    });
                    
                    // Keep last 50 points
                    if (state.trackingHistory[tracked.id].length > 50) {
                        state.trackingHistory[tracked.id].shift();
                    }
                }
            });
            
            $('trackedCount').textContent = state.trackedObjects.length;
            $('lockedCount').textContent = state.trackedObjects.filter(t => t.locked).length;
            $('trackingValue').textContent = state.trackedObjects.filter(t => t.locked).length;
            $('trackingCount').textContent = `${state.trackedObjects.filter(t => t.locked).length} tracking`;
        }
        
        function toggleTrackObject(id) {
            const obj = state.trackedObjects.find(t => t.id === id);
            if (obj) {
                obj.locked = !obj.locked;
                if (!obj.locked) {
                    delete state.trackingHistory[id];
                }
                updateTrackingTargets();
                toast(obj.locked ? `Tracking ${obj.class}` : `Stopped tracking ${obj.class}`, 'info');
            }
        }
        
        function updateTrackingTargets() {
            // Update tracked objects list from detections
            state.objects.forEach(obj => {
                const existing = state.trackedObjects.find(t => 
                    t.class === obj.class && 
                    Math.abs(t.bbox[0] - obj.bbox[0]) < 100 &&
                    Math.abs(t.bbox[1] - obj.bbox[1]) < 100
                );
                
                if (!existing) {
                    state.trackedObjects.push({
                        id: Date.now() + Math.random(),
                        class: obj.class,
                        bbox: obj.bbox,
                        score: obj.score,
                        locked: false,
                        lastSeen: state.currentTime
                    });
                }
            });
            
            // Remove old objects
            state.trackedObjects = state.trackedObjects.filter(t => 
                t.locked || (state.currentTime - t.lastSeen) < 2000
            );
            
            // Render list
            const container = $('trackingTargets');
            if (state.trackedObjects.length === 0) {
                container.innerHTML = '<div style="color:var(--text-400);font-size:10px;text-align:center;padding:15px">Objects will appear here</div>';
                return;
            }
            
            container.innerHTML = state.trackedObjects.map(t => `
                <div class="tracking-target ${t.locked ? 'tracking-target--active' : ''}" onclick="toggleTrackObject(${t.id})">
                    <div class="tracking-target__icon">${getObjectEmoji(t.class)}</div>
                    <div class="tracking-target__info">
                        <div class="tracking-target__name">${t.class}</div>
                        <div class="tracking-target__status">${Math.round(t.score * 100)}% confidence</div>
                    </div>
                    <button class="tracking-target__lock ${t.locked ? 'tracking-target__lock--locked' : ''}" onclick="event.stopPropagation();toggleTrackObject(${t.id})">
                        ${t.locked ? 'üîí' : 'üîì'}
                    </button>
                </div>
            `).join('');
        }
        
        function getObjectEmoji(cls) {
            const emojis = {
                person: 'üë§', car: 'üöó', dog: 'üêï', cat: 'üêà', phone: 'üì±',
                laptop: 'üíª', cup: '‚òï', bottle: 'üçº', book: 'üìö', chair: 'ü™ë',
                tv: 'üì∫', remote: 'üéÆ', keyboard: '‚å®Ô∏è', mouse: 'üñ±Ô∏è', clock: 'üïê'
            };
            return emojis[cls] || 'üì¶';
        }
        
        function clearTracking() {
            state.trackedObjects = [];
            state.trackingHistory = {};
            updateTrackingTargets();
            toast('Tracking cleared', 'info');
        }
        
        function renderTracking() {
            const overlay = $('trackingOverlay');
            const video = $('video');
            overlay.innerHTML = '';
            
            const vw = video.videoWidth || 640;
            const vh = video.videoHeight || 480;
            const dw = video.offsetWidth;
            const dh = video.offsetHeight;
            const scale = Math.min(dw / vw, dh / vh);
            const ox = (dw - vw * scale) / 2;
            const oy = (dh - vh * scale) / 2;
            
            state.trackedObjects.filter(t => t.locked).forEach(tracked => {
                const [x, y, w, h] = tracked.bbox;
                
                // Draw tracking box
                const box = document.createElement('div');
                box.className = 'tracking-box';
                box.style.left = `${ox + x * scale}px`;
                box.style.top = `${oy + y * scale}px`;
                box.style.width = `${w * scale}px`;
                box.style.height = `${h * scale}px`;
                
                const label = document.createElement('span');
                label.className = 'tracking-box__label';
                label.innerHTML = `üéØ ${tracked.class}`;
                box.appendChild(label);
                
                overlay.appendChild(box);
                
                // Draw trail
                const history = state.trackingHistory[tracked.id] || [];
                if (history.length > 1) {
                    const trail = document.createElement('div');
                    trail.className = 'tracking-box__trail';
                    
                    history.slice(-20).forEach((point, i) => {
                        const dot = document.createElement('div');
                        dot.className = 'trail-point';
                        dot.style.left = `${ox + point.x * scale}px`;
                        dot.style.top = `${oy + point.y * scale}px`;
                        dot.style.opacity = (i / 20) * 0.8;
                        trail.appendChild(dot);
                    });
                    
                    overlay.appendChild(trail);
                }
            });
        }
        
        function renderDetections() {
            const overlay = $('detectionOverlay');
            const video = $('video');
            overlay.innerHTML = '';
            
            const vw = video.videoWidth || 640;
            const vh = video.videoHeight || 480;
            const dw = video.offsetWidth;
            const dh = video.offsetHeight;
            const scale = Math.min(dw / vw, dh / vh);
            const ox = (dw - vw * scale) / 2;
            const oy = (dh - vh * scale) / 2;
            
            // Only show non-tracked objects
            state.objects.filter(obj => {
                return !state.trackedObjects.some(t => t.locked && t.class === obj.class);
            }).forEach(obj => {
                const [x, y, w, h] = obj.bbox;
                const box = document.createElement('div');
                box.className = 'detection-box';
                box.style.left = `${ox + x * scale}px`;
                box.style.top = `${oy + y * scale}px`;
                box.style.width = `${w * scale}px`;
                box.style.height = `${h * scale}px`;
                
                const label = document.createElement('span');
                label.className = 'detection-box__label';
                label.textContent = `${obj.class} ${Math.round(obj.score * 100)}%`;
                box.appendChild(label);
                overlay.appendChild(box);
            });
            
            // Faces
            state.faces.forEach((face, i) => {
                const [x1, y1] = face.topLeft;
                const [x2, y2] = face.bottomRight;
                
                const box = document.createElement('div');
                box.className = 'detection-box detection-box--face';
                box.style.left = `${ox + x1 * scale}px`;
                box.style.top = `${oy + y1 * scale}px`;
                box.style.width = `${(x2 - x1) * scale}px`;
                box.style.height = `${(y2 - y1) * scale}px`;
                
                const label = document.createElement('span');
                label.className = 'detection-box__label';
                label.textContent = `Face ${Math.round(face.probability[0] * 100)}%`;
                box.appendChild(label);
                overlay.appendChild(box);
            });
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // LUT COLOR GRADING
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        const LUT_FILTERS = {
            'none': '',
            'teal-orange': 'sepia(20%) saturate(140%) hue-rotate(-10deg) contrast(110%)',
            'cinematic': 'contrast(110%) saturate(120%) brightness(95%)',
            'noir': 'grayscale(100%) contrast(120%) brightness(90%)',
            'vintage': 'sepia(40%) contrast(90%) brightness(105%) saturate(80%)',
            'cyberpunk': 'saturate(150%) hue-rotate(300deg) contrast(110%)',
            'bleach': 'contrast(130%) saturate(60%) brightness(110%)',
            'golden': 'sepia(30%) saturate(120%) brightness(105%) hue-rotate(-15deg)',
            'moody': 'saturate(80%) brightness(90%) contrast(110%) hue-rotate(200deg)'
        };
        
        function setLUT(lut) {
            state.currentLUT = lut;
            
            $$('.lut-preset').forEach(el => el.classList.remove('lut-preset--active'));
            document.querySelector(`[data-lut="${lut}"]`)?.classList.add('lut-preset--active');
            
            applyLUT();
            $('lutName').textContent = lut === 'none' ? 'None' : lut.replace('-', '/');
            
            toast(`LUT: ${lut}`, 'cinema');
        }
        
        function applyLUT() {
            const filter = LUT_FILTERS[state.currentLUT] || '';
            const intensity = state.lutIntensity / 100;
            
            // Apply with intensity blending
            if (intensity < 1 && filter) {
                $('video').style.filter = filter;
                $('video').style.opacity = intensity;
            } else {
                $('video').style.filter = filter;
                $('video').style.opacity = 1;
            }
            
            $('playbackVideo').style.filter = filter;
            
            // Update timeline
            $('lutTrackFill').style.width = state.currentLUT !== 'none' ? '100%' : '0%';
        }
        
        function updateLUTIntensity() {
            state.lutIntensity = parseInt($('lutIntensity').value);
            applyLUT();
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // ANIMATED TITLES
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function setTitleAnim(anim) {
            state.titleConfig.animation = anim;
            $$('.title-anim-btn').forEach(b => b.classList.remove('title-anim-btn--active'));
            event.target.classList.add('title-anim-btn--active');
        }
        
        function previewTitle() {
            const config = {
                text: $('titleText').value || 'VIRECAI',
                size: parseInt($('titleSize').value),
                position: $('titlePosition').value,
                color: $('titleColor').value,
                duration: parseInt($('titleDuration').value),
                animation: state.titleConfig.animation
            };
            
            showTitle(config);
        }
        
        function showTitle(config) {
            const overlay = $('titleOverlay');
            overlay.innerHTML = '';
            
            const container = document.createElement('div');
            container.className = 'title-overlay';
            container.style.inset = '0';
            
            // Position
            switch (config.position) {
                case 'top': container.style.alignItems = 'flex-start'; container.style.paddingTop = '50px'; break;
                case 'bottom': container.style.alignItems = 'flex-end'; container.style.paddingBottom = '80px'; break;
                case 'lower-third': 
                    container.style.alignItems = 'flex-end'; 
                    container.style.paddingBottom = '100px';
                    container.style.justifyContent = 'flex-start';
                    container.style.paddingLeft = '30px';
                    break;
                default: container.style.alignItems = 'center';
            }
            
            const text = document.createElement('div');
            text.className = 'title-text';
            text.textContent = config.text;
            text.style.fontSize = `${config.size}px`;
            text.style.color = config.color;
            text.style.animation = `${config.animation} 0.8s ease-out`;
            
            if (config.animation === 'typewriter') {
                text.style.overflow = 'hidden';
                text.style.whiteSpace = 'nowrap';
                text.style.borderRight = '3px solid';
                text.style.animation = 'typewriter 1s steps(20) forwards';
            }
            
            if (config.animation === 'glitch') {
                text.style.animation = 'glitch 0.3s infinite';
            }
            
            container.appendChild(text);
            overlay.appendChild(container);
            
            // Remove after duration
            if (config.duration > 0) {
                setTimeout(() => {
                    text.style.animation = 'fadeOut 0.5s ease-out forwards';
                    setTimeout(() => overlay.innerHTML = '', 500);
                }, config.duration * 1000);
            }
        }
        
        function addTitle() {
            const config = {
                id: Date.now(),
                time: state.currentTime,
                text: $('titleText').value || 'VIRECAI',
                size: parseInt($('titleSize').value),
                position: $('titlePosition').value,
                color: $('titleColor').value,
                duration: parseInt($('titleDuration').value),
                animation: state.titleConfig.animation
            };
            
            state.titles.push(config);
            updateTitlesTimeline();
            
            toast('Title added to timeline', 'success');
        }
        
        function updateTitlesTimeline() {
            const track = $('titlesTrackContent');
            track.innerHTML = state.titles.map(t => {
                const left = (t.time / state.duration) * 100;
                const width = Math.max(3, ((t.duration || 3) * 1000 / state.duration) * 100);
                return `<div class="timeline-track__fill" style="left:${left}%;width:${width}%;position:absolute"></div>`;
            }).join('');
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // CHROMA KEY
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function setChromaColor(color) {
            $$('.chroma-color-btn').forEach(b => b.classList.remove('chroma-color-btn--active'));
            document.querySelector(`[data-color="${color}"]`).classList.add('chroma-color-btn--active');
            
            if (color === 'green') state.chromaColor = { r: 0, g: 255, b: 0 };
            else if (color === 'blue') state.chromaColor = { r: 0, g: 0, b: 255 };
        }
        
        function pickChromaColor() {
            $('chromaColorPicker').click();
        }
        
        function setCustomChromaColor() {
            const hex = $('chromaColorPicker').value;
            state.chromaColor = {
                r: parseInt(hex.slice(1, 3), 16),
                g: parseInt(hex.slice(3, 5), 16),
                b: parseInt(hex.slice(5, 7), 16)
            };
            $$('.chroma-color-btn').forEach(b => b.classList.remove('chroma-color-btn--active'));
            document.querySelector('[data-color="custom"]').classList.add('chroma-color-btn--active');
        }
        
        function updateChroma() {
            state.chromaThreshold = parseInt($('chromaThreshold').value);
            state.chromaSmoothing = parseInt($('chromaSmoothing').value);
            state.chromaSpill = parseInt($('chromaSpill').value);
            
            $('chromaThreshVal').textContent = state.chromaThreshold;
            $('chromaSmoothVal').textContent = state.chromaSmoothing;
            $('chromaSpillVal').textContent = state.chromaSpill;
        }
        
        function setChromaBg(bg) {
            state.chromaBg = bg;
            toast(`Background: ${bg}`, 'info');
        }
        
        function toggleChroma() {
            state.chromaEnabled = !state.chromaEnabled;
            $('chromaToggleText').textContent = state.chromaEnabled ? 'Disable Chroma Key' : 'Enable Chroma Key';
            $('chromaCanvas').classList.toggle('hidden', !state.chromaEnabled);
            
            if (state.chromaEnabled) {
                processChroma();
            }
            
            toast(`Chroma key ${state.chromaEnabled ? 'enabled' : 'disabled'}`, 'info');
        }
        
        function processChroma() {
            if (!state.chromaEnabled || !state.cameraReady) return;
            
            const video = $('video');
            const canvas = $('chromaCanvas');
            const ctx = canvas.getContext('2d');
            
            canvas.width = video.videoWidth || 640;
            canvas.height = video.videoHeight || 480;
            
            ctx.drawImage(video, 0, 0);
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            
            const { r: kr, g: kg, b: kb } = state.chromaColor;
            const threshold = state.chromaThreshold * 2.55;
            
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                
                // Calculate color distance
                const dist = Math.sqrt(
                    Math.pow(r - kr, 2) + 
                    Math.pow(g - kg, 2) + 
                    Math.pow(b - kb, 2)
                );
                
                if (dist < threshold) {
                    data[i + 3] = 0; // Make transparent
                }
            }
            
            ctx.putImageData(imageData, 0, 0);
            
            requestAnimationFrame(processChroma);
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // STORYBOARD
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function updateStoryboard() {
            const grid = $('storyboardGrid');
            
            if (state.scenes.length === 0) {
                grid.innerHTML = '<div style="color:var(--text-400);font-size:10px;text-align:center;padding:30px;grid-column:span 2">Record to generate storyboard</div>';
                return;
            }
            
            grid.innerHTML = state.scenes.map((scene, i) => `
                <div class="storyboard-card ${i === state.currentScene - 1 ? 'storyboard-card--active' : ''}" onclick="jumpToScene(${i})">
                    <div class="storyboard-card__thumb">
                        üé¨
                        <span class="storyboard-card__number">${i + 1}</span>
                        <span class="storyboard-card__duration">${formatTime(scene.duration || 0)}</span>
                    </div>
                    <div class="storyboard-card__info">
                        <div class="storyboard-card__title">Scene ${i + 1}</div>
                        <div class="storyboard-card__meta">${scene.objects || 0} objects ‚Ä¢ ${scene.faces || 0} faces</div>
                    </div>
                </div>
            `).join('');
            
            $('storyScenes').textContent = state.scenes.length;
            $('storyDuration').textContent = formatTime(state.currentTime);
        }
        
        function jumpToScene(index) {
            state.currentScene = index + 1;
            $('sceneValue').textContent = state.currentScene;
            updateStoryboard();
        }
        
        function regenerateStoryboard() {
            toast('Regenerating storyboard...', 'info');
            updateStoryboard();
        }
        
        function addScene() {
            state.scenes.push({
                id: state.scenes.length + 1,
                time: state.currentTime,
                objects: state.objects.length,
                faces: state.faces.length,
                duration: 0
            });
            
            if (state.scenes.length > 1) {
                state.scenes[state.scenes.length - 2].duration = 
                    state.currentTime - state.scenes[state.scenes.length - 2].time;
            }
            
            state.currentScene = state.scenes.length;
            $('sceneValue').textContent = state.currentScene;
            
            updateStoryboard();
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // CAMERA
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function requestCamera() {
            $('placeholderText').textContent = 'Requesting...';
            
            try {
                if (state.stream) state.stream.getTracks().forEach(t => t.stop());
                
                state.stream = await navigator.mediaDevices.getUserMedia({
                    video: { facingMode: state.facingMode, width: { ideal: 1280 }, height: { ideal: 720 } },
                    audio: true
                });
                
                const video = $('video');
                video.srcObject = state.stream;
                await video.play();
                
                if (state.facingMode === 'user') video.classList.add('viewport__video--mirrored');
                else video.classList.remove('viewport__video--mirrored');
                
                $('placeholder').classList.add('hidden');
                state.cameraReady = true;
                
                toast('Camera ready!', 'success');
            } catch (e) {
                $('placeholderText').textContent = e.message || 'Failed';
                toast('Camera error', 'error');
            }
        }
        
        async function switchCamera() {
            state.facingMode = state.facingMode === 'user' ? 'environment' : 'user';
            if (state.stream) state.stream.getTracks().forEach(t => t.stop());
            $('placeholder').classList.remove('hidden');
            await requestCamera();
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // RECORDING
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function toggleRecording() {
            if (!state.cameraReady) return toast('Enable camera first', 'warning');
            state.isRecording ? stopRecording() : startRecording();
        }
        
        function startRecording() {
            state.recordedChunks = [];
            state.scenes = [];
            state.trackedObjects = [];
            state.trackingHistory = {};
            
            let mimeType = 'video/webm;codecs=vp9';
            if (!MediaRecorder.isTypeSupported(mimeType)) mimeType = 'video/webm';
            
            state.mediaRecorder = new MediaRecorder(state.stream, { mimeType, videoBitsPerSecond: 5000000 });
            
            state.mediaRecorder.ondataavailable = e => { if (e.data.size > 0) state.recordedChunks.push(e.data); };
            
            state.mediaRecorder.onstop = () => {
                state.recordedBlob = new Blob(state.recordedChunks, { type: 'video/webm' });
                state.recordedUrl = URL.createObjectURL(state.recordedBlob);
                $('playbackVideo').src = state.recordedUrl;
                toast('Recording saved!', 'success');
            };
            
            state.mediaRecorder.start(100);
            state.isRecording = true;
            state.startTime = performance.now();
            state.frameCount = 0;
            
            addScene();
            
            $('recordBtn').classList.add('recording');
            $('statusDot').classList.add('status-dot--recording');
            $('statusText').textContent = 'REC';
            
            captureLoop();
        }
        
        function stopRecording() {
            state.isRecording = false;
            state.duration = state.currentTime;
            if (state.mediaRecorder?.state !== 'inactive') state.mediaRecorder.stop();
            
            $('recordBtn').classList.remove('recording');
            $('statusDot').classList.remove('status-dot--recording');
            $('statusText').textContent = 'Ready';
            
            updateStoryboard();
        }
        
        async function captureLoop() {
            if (!state.isRecording) return;
            
            state.currentTime = performance.now() - state.startTime;
            state.frameCount++;
            
            updateUI();
            
            if (state.frameCount % 6 === 0) await runAIDetection();
            
            // Auto scene detection (every 5 seconds or significant change)
            if (state.frameCount % 150 === 0) {
                addScene();
            }
            
            requestAnimationFrame(captureLoop);
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // PLAYBACK
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function togglePlayback() {
            if (!state.recordedUrl) return toast('Nothing to play', 'warning');
            
            const v = $('playbackVideo');
            const live = $('video');
            
            if (state.isPlaying) {
                v.pause();
                state.isPlaying = false;
                $('playBtn').textContent = '‚ñ∂Ô∏è';
            } else {
                live.classList.add('hidden');
                v.classList.remove('hidden');
                v.play();
                state.isPlaying = true;
                $('playBtn').textContent = '‚è∏Ô∏è';
            }
        }
        
        function setSpeed() { $('playbackVideo').playbackRate = parseFloat($('speedSelect').value); }
        function jumpBack() { const v = $('playbackVideo'); if (v.duration) v.currentTime = Math.max(0, v.currentTime - 5); }
        function jumpForward() { const v = $('playbackVideo'); if (v.duration) v.currentTime = Math.min(v.duration, v.currentTime + 5); }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // EXPORT
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function exportVideo() {
            if (!state.recordedBlob) return toast('Nothing to export', 'warning');
            
            const a = document.createElement('a');
            a.href = state.recordedUrl;
            a.download = `virecai_cinema_${Date.now()}.webm`;
            a.click();
            
            toast('Video exported!', 'success');
        }
        
        function exportCapsule() {
            const capsule = {
                version: VERSION,
                timestamp: Date.now(),
                duration: state.duration,
                scenes: state.scenes,
                titles: state.titles,
                lut: state.currentLUT,
                tracking: state.trackedObjects.filter(t => t.locked).map(t => ({
                    class: t.class,
                    history: state.trackingHistory[t.id]
                }))
            };
            
            const blob = new Blob([JSON.stringify(capsule, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `virecai_cinema_${Date.now()}.vrc`;
            a.click();
            
            toast('Cinematic Capsule exported!', 'success');
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // UI
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function updateUI() {
            const s = Math.floor(state.currentTime / 1000);
            const ms = Math.floor((state.currentTime % 1000) / 10);
            const m = Math.floor(s / 60);
            
            $('timeDisplay').innerHTML = `${m}:${pad(s % 60)}<span class="float-panel__unit">.${pad(ms)}</span>`;
            $('currentTime').textContent = formatTime(state.currentTime);
            
            const progress = (state.currentTime / state.duration) * 100;
            $('videoTrackFill').style.width = `${Math.min(100, progress)}%`;
            $('videoCursor').style.left = `${Math.min(100, progress)}%`;
        }
        
        function formatTime(ms) {
            const s = Math.floor(ms / 1000);
            const m = Math.floor(s / 60);
            return `${m}:${pad(s % 60)}`;
        }
        
        function pad(n) { return String(n).padStart(2, '0'); }
        
        function switchTab(id) {
            $$('.sidebar__tab').forEach(t => t.classList.remove('sidebar__tab--active'));
            $$('.sidebar__panel').forEach(p => p.classList.remove('sidebar__panel--active'));
            document.querySelector(`.sidebar__tab[data-tab="${id}"]`).classList.add('sidebar__tab--active');
            $(`${id}Panel`).classList.add('sidebar__panel--active');
        }
        
        function undo() { toast('Undo', 'info'); }
        function redo() { toast('Redo', 'info'); }
        
        document.addEventListener('keydown', e => {
            if (e.target.tagName === 'INPUT') return;
            if (e.key === ' ') { e.preventDefault(); togglePlayback(); }
            if (e.key === 'r') toggleRecording();
            if (e.key === 't') previewTitle();
        });
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // INIT
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        async function init() {
            console.log('Initializing VIRECAI v8.3 CINEMATIC...');
            
            loadAIModels();
            
            if (!isMobile) await requestCamera();
            
            toast(`VIRECAI v${VERSION} Cinematic Ready`, 'cinema');
        }
        
        init();
    </script>
</body>
</html>
