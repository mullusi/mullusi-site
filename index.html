<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MulluSI v5.6 | Complete UHRTS Framework</title>
    <style>
        :root {
            --void: #020204;
            --abyss: #08090d;
            --deep: #0f1015;
            --surface: #16171f;
            --elevated: #1e2028;
            --gold: #d4a574;
            --gold-dim: rgba(212, 165, 116, 0.25);
            --emerald: #10b981;
            --cyan: #06b6d4;
            --violet: #8b5cf6;
            --rose: #f43f5e;
            --blue: #3b82f6;
            --amber: #f59e0b;
            --lime: #84cc16;
            --pink: #ec4899;
            --white: #f0f0f0;
            --muted: rgba(255,255,255,0.45);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'SF Pro Display', -apple-system, system-ui, sans-serif;
            background: var(--void);
            color: var(--white);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app {
            display: grid;
            grid-template-rows: 55px 1fr;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(180deg, var(--abyss) 0%, var(--deep) 100%);
            border-bottom: 1px solid var(--gold-dim);
            padding: 0 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-glyph {
            font-size: 1.4rem;
            color: var(--gold);
        }

        .logo h1 { font-size: 0.9rem; font-weight: 500; }
        .logo h1 span { color: var(--gold); }

        .version-badge {
            background: linear-gradient(135deg, var(--cyan), var(--blue));
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.48rem;
            font-weight: 700;
            margin-left: 8px;
        }

        .metrics-bar { display: flex; gap: 12px; }
        .metric { text-align: center; }
        .metric-value { font-size: 0.85rem; font-weight: 600; }
        .metric-label { font-size: 0.4rem; color: var(--muted); text-transform: uppercase; }

        .header-controls { display: flex; gap: 6px; }
        .btn {
            padding: 6px 12px;
            background: var(--surface);
            border: 1px solid var(--gold-dim);
            border-radius: 5px;
            color: var(--white);
            cursor: pointer;
            font-size: 0.55rem;
            transition: all 0.15s;
        }
        .btn:hover { background: var(--elevated); border-color: var(--gold); }
        .btn.primary { background: var(--gold); color: var(--void); }

        /* Main Layout */
        .main {
            display: grid;
            grid-template-columns: 260px 1fr 260px;
            height: calc(100vh - 55px);
            overflow: hidden;
        }

        .side-panel {
            background: var(--abyss);
            border-right: 1px solid rgba(255,255,255,0.05);
            padding: 10px;
            overflow-y: auto;
            font-size: 0.52rem;
        }
        .side-panel:last-child { border-right: none; border-left: 1px solid rgba(255,255,255,0.05); }

        .section-title {
            font-size: 0.46rem;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 8px 0 4px 0;
            padding-bottom: 3px;
            border-bottom: 1px solid var(--gold-dim);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .card {
            background: var(--surface);
            border-radius: 5px;
            padding: 6px;
            margin-bottom: 5px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
            font-size: 0.45rem;
        }
        .stat-label { color: var(--muted); }
        .stat-value { color: var(--white); font-family: monospace; }

        /* WH Categories Grid */
        .wh-categories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 4px;
        }

        .wh-cat {
            padding: 5px;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .wh-cat:hover { transform: scale(1.02); }
        .wh-cat.active { border-color: var(--gold); }

        .wh-cat-name { font-size: 0.4rem; font-weight: bold; }
        .wh-cat-count { font-size: 0.5rem; color: var(--white); }

        .wh-cat.essence { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .wh-cat.temporal { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .wh-cat.spatial { background: linear-gradient(135deg, #10b981, #059669); }
        .wh-cat.agency { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .wh-cat.causation { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .wh-cat.selection { background: linear-gradient(135deg, #ec4899, #db2777); }
        .wh-cat.mechanism { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .wh-cat.context { background: linear-gradient(135deg, #84cc16, #65a30d); }

        /* Layers Display */
        .layers-list {
            max-height: 180px;
            overflow-y: auto;
        }

        .layer-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px;
            border-radius: 3px;
            margin-bottom: 2px;
            background: var(--elevated);
            cursor: pointer;
            transition: all 0.2s;
        }

        .layer-item:hover { background: rgba(212, 165, 116, 0.1); }
        .layer-item.active { border-left: 2px solid var(--gold); }

        .layer-num {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--surface);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.4rem;
            font-weight: bold;
        }

        .layer-name { font-size: 0.42rem; flex: 1; }
        .layer-v { font-size: 0.5rem; }

        /* Reasoning Modes */
        .modes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 3px;
        }

        .mode-item {
            padding: 4px;
            border-radius: 3px;
            text-align: center;
            font-size: 0.4rem;
            background: var(--elevated);
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-item:hover { background: rgba(6, 182, 212, 0.2); }
        .mode-item.active { background: rgba(6, 182, 212, 0.3); border: 1px solid var(--cyan); }

        /* Phases Timeline */
        .phases-timeline {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
        }

        .phase-dot {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--elevated);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.4rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .phase-dot.complete { background: var(--emerald); color: var(--void); }
        .phase-dot.active { background: var(--cyan); color: var(--void); animation: pulse 1s infinite; }
        .phase-dot.pending { background: var(--surface); }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Completeness Criteria */
        .criteria-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .criterion {
            padding: 4px;
            margin-bottom: 3px;
            background: var(--elevated);
            border-radius: 3px;
        }

        .criterion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.42rem;
        }

        .criterion-name { flex: 1; }
        .criterion-weight { color: var(--muted); }
        .criterion-score { font-weight: bold; }

        .criterion-bar {
            height: 3px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            margin-top: 2px;
            overflow: hidden;
        }

        .criterion-fill {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* Center Visualization */
        .viz-container {
            background: var(--void);
            position: relative;
            overflow: hidden;
        }

        .viz-canvas { width: 100%; height: 100%; }

        .formula-overlay {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(8, 9, 13, 0.95);
            border: 1px solid var(--cyan);
            border-radius: 8px;
            padding: 8px 16px;
            text-align: center;
        }

        .formula-title {
            font-size: 0.45rem;
            color: var(--cyan);
            text-transform: uppercase;
        }

        .formula-main {
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            color: var(--gold);
            font-weight: bold;
        }

        .input-area {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 5px;
        }

        .input-field {
            width: 200px;
            padding: 8px 12px;
            background: var(--surface);
            border: 1px solid var(--gold-dim);
            border-radius: 5px;
            color: var(--white);
            font-size: 0.9rem;
            text-align: center;
        }

        /* Wholeness Score Display */
        .wholeness-display {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
        }

        .wholeness-label { font-size: 0.45rem; color: var(--muted); }
        .wholeness-value { font-size: 2rem; font-weight: bold; color: var(--gold); }
        .wholeness-interpretation { font-size: 0.5rem; color: var(--emerald); }

        /* Progress Bars */
        .progress-bar {
            height: 5px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 3px 0;
        }
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s;
        }
        .progress-fill.gold { background: var(--gold); }
        .progress-fill.cyan { background: var(--cyan); }
        .progress-fill.emerald { background: var(--emerald); }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: var(--void); }
        ::-webkit-scrollbar-thumb { background: var(--gold-dim); border-radius: 2px; }
    </style>
</head>
<body>
    <div class="app">
        <header class="header">
            <div class="logo">
                <span class="logo-glyph">·àô·àâ‚àø</span>
                <h1><span>MulluSI</span> v5.6<span class="version-badge">COMPLETE UHRTS</span></h1>
            </div>
            <div class="metrics-bar">
                <div class="metric">
                    <div class="metric-value" style="color: var(--cyan);" id="m-tick">0</div>
                    <div class="metric-label">Tick</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: var(--blue);" id="m-questions">73</div>
                    <div class="metric-label">WH-Questions</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: var(--violet);" id="m-layers">11</div>
                    <div class="metric-label">Layers</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: var(--amber);" id="m-modes">10</div>
                    <div class="metric-label">Modes</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: var(--emerald);" id="m-phase">0</div>
                    <div class="metric-label">Phase</div>
                </div>
                <div class="metric">
                    <div class="metric-value" style="color: var(--gold);" id="m-wholeness">0%</div>
                    <div class="metric-label">Wholeness</div>
                </div>
            </div>
            <div class="header-controls">
                <button class="btn" id="btn-run">‚ñ∂ Run</button>
                <button class="btn primary" id="btn-understand">Understand</button>
            </div>
        </header>

        <main class="main">
            <!-- Left Panel: WH Categories & Layers -->
            <aside class="side-panel">
                <div class="section-title">‚ùì WH Categories (70+)</div>
                <div class="card">
                    <div class="wh-categories" id="wh-categories"></div>
                </div>

                <div class="section-title">üèõ Architectural Layers (0-10)</div>
                <div class="card">
                    <div class="layers-list" id="layers-list"></div>
                </div>

                <div class="section-title">üß† Reasoning Modes (10)</div>
                <div class="card">
                    <div class="modes-grid" id="modes-grid"></div>
                </div>

                <div class="section-title">‚è± Algorithm Phases (11)</div>
                <div class="card">
                    <div class="phases-timeline" id="phases-timeline"></div>
                </div>
            </aside>

            <!-- Center: Visualization -->
            <section class="viz-container">
                <canvas class="viz-canvas" id="viz-canvas"></canvas>

                <div class="formula-overlay">
                    <div class="formula-title">Universal Holistic Reasoning & Thinking</div>
                    <div class="formula-main">‚àÄ WH ‚àà {70+} ‚Üí Understand(Subject)</div>
                </div>

                <div class="wholeness-display">
                    <div class="wholeness-label">WHOLENESS SCORE</div>
                    <div class="wholeness-value" id="wholeness-big">0%</div>
                    <div class="wholeness-interpretation" id="wholeness-interp">INITIALIZING</div>
                </div>

                <div class="input-area">
                    <input type="text" class="input-field" id="input-field" placeholder="Enter subject..." value="Consciousness">
                    <button class="btn primary" id="btn-go">‚Üí</button>
                </div>
            </section>

            <!-- Right Panel: Completeness Criteria -->
            <aside class="side-panel">
                <div class="section-title">‚úì Completeness Criteria (10)</div>
                <div class="card">
                    <div class="criteria-list" id="criteria-list"></div>
                </div>

                <div class="section-title">üìä Knowledge Graph</div>
                <div class="card">
                    <div class="stat-row">
                        <span class="stat-label">Answered:</span>
                        <span class="stat-value" id="kg-answered">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Unknowns:</span>
                        <span class="stat-value" id="kg-unknowns">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Inferences:</span>
                        <span class="stat-value" id="kg-inferences">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Predictions:</span>
                        <span class="stat-value" id="kg-predictions">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Counterfactuals:</span>
                        <span class="stat-value" id="kg-counterfactuals">0</span>
                    </div>
                </div>

                <div class="section-title">üîó Causal Graph</div>
                <div class="card">
                    <div class="stat-row">
                        <span class="stat-label">Nodes:</span>
                        <span class="stat-value" id="cg-nodes">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Edges:</span>
                        <span class="stat-value" id="cg-edges">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Critical Paths:</span>
                        <span class="stat-value" id="cg-paths">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Leverage Points:</span>
                        <span class="stat-value" id="cg-leverage">0</span>
                    </div>
                </div>

                <div class="section-title">üåê Perspectives</div>
                <div class="card">
                    <div class="stat-row">
                        <span class="stat-label">Applied:</span>
                        <span class="stat-value" id="persp-applied">0/10</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Agreements:</span>
                        <span class="stat-value" id="persp-agree">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Conflicts:</span>
                        <span class="stat-value" id="persp-conflict">0</span>
                    </div>
                </div>

                <div class="section-title">üéØ Meta-Awareness</div>
                <div class="card">
                    <div class="stat-row">
                        <span class="stat-label">Assumptions:</span>
                        <span class="stat-value" id="meta-assumptions">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Limitations:</span>
                        <span class="stat-value" id="meta-limitations">0</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Improvements:</span>
                        <span class="stat-value" id="meta-improvements">0</span>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <script>
    // =========================================================================
    // CONSTANTS
    // =========================================================================

    const WH_CATEGORIES = [
        { id: 'essence', name: 'ESSENCE', count: 12, color: '#3b82f6' },
        { id: 'temporal', name: 'TEMPORAL', count: 15, color: '#f59e0b' },
        { id: 'spatial', name: 'SPATIAL', count: 18, color: '#10b981' },
        { id: 'agency', name: 'AGENCY', count: 12, color: '#8b5cf6' },
        { id: 'causation', name: 'CAUSATION', count: 10, color: '#ef4444' },
        { id: 'selection', name: 'SELECTION', count: 11, color: '#ec4899' },
        { id: 'mechanism', name: 'MECHANISM', count: 18, color: '#06b6d4' },
        { id: 'context', name: 'CONTEXT', count: 2, color: '#84cc16' }
    ];

    const LAYERS = [
        { num: 0, name: 'META-COGNITIVE', v: '·ä§', purpose: 'Self-awareness' },
        { num: 1, name: 'ONTOLOGICAL', v: '·ä¢', purpose: 'Identity & essence' },
        { num: 2, name: 'TEMPORAL', v: '·ä£', purpose: 'Time mapping' },
        { num: 3, name: 'SPATIAL', v: '·ä£', purpose: 'Space mapping' },
        { num: 4, name: 'AGENCY', v: '·ä•', purpose: 'Actor relations' },
        { num: 5, name: 'TELEOLOGICAL', v: '·ä°', purpose: 'Purpose & cause' },
        { num: 6, name: 'MODAL', v: '·ä†', purpose: 'Possibility space' },
        { num: 7, name: 'MECHANISTIC', v: '·ä¶', purpose: 'Process & mechanism' },
        { num: 8, name: 'RELATIONAL', v: '·äß', purpose: 'Context & comparison' },
        { num: 9, name: 'COUNTERFACTUAL', v: '·ä†', purpose: 'What-if exploration' },
        { num: 10, name: 'SYNTHETIC', v: '·ä§', purpose: 'Holistic integration' }
    ];

    const REASONING_MODES = [
        'ANALYTICAL', 'SYNTHETIC', 'CAUSAL', 'TEMPORAL', 'SPATIAL',
        'MODAL', 'COMPARATIVE', 'ABDUCTIVE', 'DIALECTICAL', 'RECURSIVE'
    ];

    const PHASES = [
        'META-INIT', 'INTERROGATE', 'MULTI-MODE', 'GAP-DETECT',
        'CONTRADICT', 'COHERENCE', 'CAUSAL-GRAPH', 'PERSPECTIVE',
        'TEMPORAL', 'COUNTERFACT', 'SYNTHESIS', 'SELF-IMPROVE'
    ];

    const CRITERIA = [
        { id: 'dimensional', name: 'Dimensional Completeness', weight: 0.15, target: 0.90 },
        { id: 'depth', name: 'Depth Adequacy', weight: 0.10, target: 0.80 },
        { id: 'causal', name: 'Causal Closure', weight: 0.12, target: 0.85 },
        { id: 'logical', name: 'Logical Consistency', weight: 0.12, target: 0.90 },
        { id: 'empirical', name: 'Empirical Correspondence', weight: 0.10, target: 0.75 },
        { id: 'explanatory', name: 'Explanatory Power', weight: 0.12, target: 0.80 },
        { id: 'predictive', name: 'Predictive Capacity', weight: 0.08, target: 0.70 },
        { id: 'contextual', name: 'Contextual Awareness', weight: 0.08, target: 0.85 },
        { id: 'alternative', name: 'Alternative Recognition', weight: 0.08, target: 0.75 },
        { id: 'meta', name: 'Meta-Awareness', weight: 0.05, target: 1.00 }
    ];

    const CRITERION_COLORS = {
        dimensional: '#3b82f6', depth: '#8b5cf6', causal: '#ef4444',
        logical: '#f59e0b', empirical: '#10b981', explanatory: '#06b6d4',
        predictive: '#ec4899', contextual: '#84cc16', alternative: '#a855f7', meta: '#d4a574'
    };

    // =========================================================================
    // STATE
    // =========================================================================

    const state = {
        tick: 0,
        running: false,
        currentPhase: 0,
        activeLayer: 1,
        activeMode: 'CAUSAL',
        activeCategory: 'essence',
        
        criteriaScores: {},
        wholeness: 0,
        interpretation: 'INITIALIZING',
        
        knowledgeGraph: {
            answered: 0,
            unknowns: 0,
            inferences: 0,
            predictions: 0,
            counterfactuals: 0
        },
        
        causalGraph: {
            nodes: 0,
            edges: 0,
            criticalPaths: 0,
            leveragePoints: 0
        },
        
        perspectives: {
            applied: 0,
            agreements: 0,
            conflicts: 0
        },
        
        meta: {
            assumptions: 4,
            limitations: 0,
            improvements: 0
        }
    };

    // Initialize criteria scores
    for (const c of CRITERIA) {
        state.criteriaScores[c.id] = 0;
    }

    // =========================================================================
    // RENDER
    // =========================================================================

    function renderWHCategories() {
        const container = document.getElementById('wh-categories');
        container.innerHTML = WH_CATEGORIES.map(cat => `
            <div class="wh-cat ${cat.id} ${state.activeCategory === cat.id ? 'active' : ''}"
                 onclick="selectCategory('${cat.id}')">
                <div class="wh-cat-count">${cat.count}</div>
                <div class="wh-cat-name">${cat.name}</div>
            </div>
        `).join('');
    }

    function renderLayers() {
        const container = document.getElementById('layers-list');
        container.innerHTML = LAYERS.map(layer => `
            <div class="layer-item ${state.activeLayer === layer.num ? 'active' : ''}"
                 onclick="selectLayer(${layer.num})">
                <div class="layer-num" style="background: ${layer.num <= state.currentPhase ? 'var(--emerald)' : 'var(--surface)'};">${layer.num}</div>
                <div class="layer-name">${layer.name}</div>
                <div class="layer-v">${layer.v}</div>
            </div>
        `).join('');
    }

    function renderModes() {
        const container = document.getElementById('modes-grid');
        container.innerHTML = REASONING_MODES.map(mode => `
            <div class="mode-item ${state.activeMode === mode ? 'active' : ''}"
                 onclick="selectMode('${mode}')">
                ${mode}
            </div>
        `).join('');
    }

    function renderPhases() {
        const container = document.getElementById('phases-timeline');
        container.innerHTML = PHASES.map((phase, i) => {
            let status = 'pending';
            if (i < state.currentPhase) status = 'complete';
            if (i === state.currentPhase) status = 'active';
            return `
                <div class="phase-dot ${status}" title="${phase}">${i}</div>
            `;
        }).join('');
    }

    function renderCriteria() {
        const container = document.getElementById('criteria-list');
        container.innerHTML = CRITERIA.map(c => {
            const score = state.criteriaScores[c.id] || 0;
            const color = CRITERION_COLORS[c.id];
            const meetsTarget = score >= c.target;
            return `
                <div class="criterion">
                    <div class="criterion-header">
                        <span class="criterion-name">${c.name}</span>
                        <span class="criterion-weight">${(c.weight * 100).toFixed(0)}%</span>
                        <span class="criterion-score" style="color: ${meetsTarget ? 'var(--emerald)' : 'var(--rose)'};">
                            ${(score * 100).toFixed(0)}%
                        </span>
                    </div>
                    <div class="criterion-bar">
                        <div class="criterion-fill" style="width: ${score * 100}%; background: ${color};"></div>
                    </div>
                </div>
            `;
        }).join('');
    }

    function updateUI() {
        document.getElementById('m-tick').textContent = state.tick;
        document.getElementById('m-questions').textContent = WH_CATEGORIES.reduce((s, c) => s + c.count, 0);
        document.getElementById('m-layers').textContent = LAYERS.length;
        document.getElementById('m-modes').textContent = REASONING_MODES.length;
        document.getElementById('m-phase').textContent = state.currentPhase;
        document.getElementById('m-wholeness').textContent = (state.wholeness * 100).toFixed(0) + '%';

        document.getElementById('wholeness-big').textContent = (state.wholeness * 100).toFixed(0) + '%';
        document.getElementById('wholeness-interp').textContent = state.interpretation;
        document.getElementById('wholeness-interp').style.color = 
            state.wholeness >= 0.85 ? 'var(--emerald)' : 
            state.wholeness >= 0.65 ? 'var(--amber)' : 'var(--rose)';

        document.getElementById('kg-answered').textContent = state.knowledgeGraph.answered;
        document.getElementById('kg-unknowns').textContent = state.knowledgeGraph.unknowns;
        document.getElementById('kg-inferences').textContent = state.knowledgeGraph.inferences;
        document.getElementById('kg-predictions').textContent = state.knowledgeGraph.predictions;
        document.getElementById('kg-counterfactuals').textContent = state.knowledgeGraph.counterfactuals;

        document.getElementById('cg-nodes').textContent = state.causalGraph.nodes;
        document.getElementById('cg-edges').textContent = state.causalGraph.edges;
        document.getElementById('cg-paths').textContent = state.causalGraph.criticalPaths;
        document.getElementById('cg-leverage').textContent = state.causalGraph.leveragePoints;

        document.getElementById('persp-applied').textContent = `${state.perspectives.applied}/10`;
        document.getElementById('persp-agree').textContent = state.perspectives.agreements;
        document.getElementById('persp-conflict').textContent = state.perspectives.conflicts;

        document.getElementById('meta-assumptions').textContent = state.meta.assumptions;
        document.getElementById('meta-limitations').textContent = state.meta.limitations;
        document.getElementById('meta-improvements').textContent = state.meta.improvements;

        renderWHCategories();
        renderLayers();
        renderModes();
        renderPhases();
        renderCriteria();
    }

    // =========================================================================
    // INTERACTION
    // =========================================================================

    window.selectCategory = function(id) {
        state.activeCategory = id;
        updateUI();
    };

    window.selectLayer = function(num) {
        state.activeLayer = num;
        updateUI();
    };

    window.selectMode = function(mode) {
        state.activeMode = mode;
        updateUI();
    };

    // =========================================================================
    // VISUALIZATION
    // =========================================================================

    const canvas = document.getElementById('viz-canvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
        canvas.width = canvas.parentElement.clientWidth;
        canvas.height = canvas.parentElement.clientHeight;
    }

    function drawVisualization() {
        ctx.fillStyle = '#020204';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        const cx = canvas.width / 2;
        const cy = canvas.height / 2 - 30;
        const time = Date.now() / 1000;

        // Draw 11 layer rings
        for (let i = 0; i <= 10; i++) {
            const radius = 50 + i * 18;
            const layer = LAYERS[i];
            const active = i <= state.currentPhase;
            
            ctx.beginPath();
            ctx.arc(cx, cy, radius, 0, Math.PI * 2);
            ctx.strokeStyle = active ? `rgba(212, 165, 116, ${0.3 + i * 0.05})` : 'rgba(255,255,255,0.05)';
            ctx.lineWidth = active ? 2 : 1;
            ctx.stroke();

            // Layer number
            const labelAngle = -Math.PI / 2 + i * 0.3;
            const lx = cx + Math.cos(labelAngle) * radius;
            const ly = cy + Math.sin(labelAngle) * radius;
            
            ctx.fillStyle = active ? '#d4a574' : 'rgba(255,255,255,0.2)';
            ctx.font = '8px monospace';
            ctx.textAlign = 'center';
            ctx.fillText(`L${i}`, lx, ly);
        }

        // Draw WH category nodes around the ring
        const catRadius = 50 + 10 * 18 + 30;
        WH_CATEGORIES.forEach((cat, i) => {
            const angle = (i / WH_CATEGORIES.length) * Math.PI * 2 - Math.PI / 2;
            const x = cx + Math.cos(angle) * catRadius;
            const y = cy + Math.sin(angle) * catRadius;

            // Connection line
            ctx.beginPath();
            ctx.moveTo(cx, cy);
            ctx.lineTo(x, y);
            ctx.strokeStyle = `${cat.color}33`;
            ctx.lineWidth = 1;
            ctx.stroke();

            // Node
            ctx.beginPath();
            ctx.arc(x, y, 12, 0, Math.PI * 2);
            ctx.fillStyle = state.activeCategory === cat.id ? cat.color : `${cat.color}66`;
            ctx.fill();

            ctx.fillStyle = '#fff';
            ctx.font = '6px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(cat.name.substring(0, 3), x, y + 2);
        });

        // Draw reasoning mode wheel in center
        const modeRadius = 35;
        REASONING_MODES.forEach((mode, i) => {
            const angle = (i / REASONING_MODES.length) * Math.PI * 2 - Math.PI / 2 + time * 0.1;
            const x = cx + Math.cos(angle) * modeRadius;
            const y = cy + Math.sin(angle) * modeRadius;

            ctx.beginPath();
            ctx.arc(x, y, 5, 0, Math.PI * 2);
            ctx.fillStyle = state.activeMode === mode ? '#06b6d4' : 'rgba(6, 182, 212, 0.3)';
            ctx.fill();
        });

        // Center subject display
        ctx.beginPath();
        ctx.arc(cx, cy, 25, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(30, 32, 40, 0.9)';
        ctx.fill();
        ctx.strokeStyle = '#d4a574';
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.fillStyle = '#d4a574';
        ctx.font = 'bold 9px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('SUBJECT', cx, cy - 3);
        ctx.font = '7px sans-serif';
        ctx.fillText(`Phase ${state.currentPhase}`, cx, cy + 8);

        // Wholeness arc
        ctx.beginPath();
        ctx.arc(cx, cy, 28, -Math.PI / 2, -Math.PI / 2 + state.wholeness * Math.PI * 2);
        ctx.strokeStyle = state.wholeness >= 0.85 ? '#10b981' : state.wholeness >= 0.65 ? '#f59e0b' : '#ef4444';
        ctx.lineWidth = 3;
        ctx.stroke();
    }

    // =========================================================================
    // ENGINE
    // =========================================================================

    function calculateWholeness() {
        let total = 0;
        for (const c of CRITERIA) {
            total += (state.criteriaScores[c.id] || 0) * c.weight;
        }
        state.wholeness = total;

        if (total >= 0.95) state.interpretation = 'EXCEPTIONAL';
        else if (total >= 0.85) state.interpretation = 'EXCELLENT';
        else if (total >= 0.75) state.interpretation = 'GOOD';
        else if (total >= 0.65) state.interpretation = 'FAIR';
        else state.interpretation = 'POOR';
    }

    function runPhase() {
        state.currentPhase = Math.min(11, state.currentPhase + 1);
        state.activeLayer = Math.min(10, state.currentPhase);

        // Simulate progress
        state.knowledgeGraph.answered += Math.floor(Math.random() * 8) + 3;
        state.knowledgeGraph.inferences += Math.floor(Math.random() * 3);
        
        if (state.currentPhase >= 6) {
            state.causalGraph.nodes += Math.floor(Math.random() * 5) + 2;
            state.causalGraph.edges += Math.floor(Math.random() * 8) + 3;
        }
        
        if (state.currentPhase >= 7) {
            state.perspectives.applied = Math.min(10, state.perspectives.applied + 2);
        }
        
        if (state.currentPhase >= 9) {
            state.knowledgeGraph.counterfactuals += Math.floor(Math.random() * 4) + 1;
        }

        // Update criteria scores
        for (const c of CRITERIA) {
            const progress = state.currentPhase / 11;
            const target = c.target;
            state.criteriaScores[c.id] = Math.min(target, progress * target + Math.random() * 0.1);
        }

        if (state.currentPhase >= 11) {
            state.meta.limitations = 2;
            state.meta.improvements = 3;
            state.criteriaScores.meta = 1.0;
        }

        calculateWholeness();
        updateUI();
        drawVisualization();
    }

    function process(subject) {
        state.tick++;
        state.currentPhase = 0;
        state.knowledgeGraph = { answered: 0, unknowns: 0, inferences: 0, predictions: 0, counterfactuals: 0 };
        state.causalGraph = { nodes: 0, edges: 0, criticalPaths: 0, leveragePoints: 0 };
        state.perspectives = { applied: 0, agreements: 0, conflicts: 0 };
        
        for (const c of CRITERIA) {
            state.criteriaScores[c.id] = 0;
        }
        
        // Run all phases with delays
        let phase = 0;
        const interval = setInterval(() => {
            runPhase();
            phase++;
            if (phase >= 12) {
                clearInterval(interval);
                state.causalGraph.criticalPaths = Math.floor(Math.random() * 5) + 2;
                state.causalGraph.leveragePoints = Math.floor(Math.random() * 4) + 1;
                state.knowledgeGraph.predictions = Math.floor(Math.random() * 6) + 2;
                updateUI();
            }
        }, 300);
    }

    function step() {
        state.tick++;
        
        // Small updates
        for (const c of CRITERIA) {
            state.criteriaScores[c.id] = Math.min(c.target, 
                state.criteriaScores[c.id] + (Math.random() - 0.3) * 0.02);
        }
        
        calculateWholeness();
        updateUI();
        drawVisualization();
    }

    function runLoop() {
        if (!state.running) return;
        step();
        setTimeout(runLoop, 500);
    }

    // =========================================================================
    // EVENTS
    // =========================================================================

    document.getElementById('btn-run').addEventListener('click', function() {
        state.running = !state.running;
        this.textContent = state.running ? '‚è∏ Pause' : '‚ñ∂ Run';
        if (state.running) runLoop();
    });

    document.getElementById('btn-understand').addEventListener('click', () => {
        const subject = document.getElementById('input-field').value;
        if (subject) process(subject);
    });

    document.getElementById('btn-go').addEventListener('click', () => {
        const subject = document.getElementById('input-field').value;
        if (subject) process(subject);
    });

    document.getElementById('input-field').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const subject = document.getElementById('input-field').value;
            if (subject) process(subject);
        }
    });

    // =========================================================================
    // ANIMATION
    // =========================================================================

    function animate() {
        drawVisualization();
        requestAnimationFrame(animate);
    }

    // =========================================================================
    // INIT
    // =========================================================================

    window.addEventListener('resize', resizeCanvas);

    resizeCanvas();
    updateUI();
    animate();

    console.log('MulluSI v5.6 Complete UHRTS Framework initialized');
    console.log('70+ WH-questions ‚Üí 11 Layers ‚Üí 10 Modes ‚Üí 11 Phases ‚Üí 10 Criteria ‚Üí Wholeness');
    </script>
</body>
</html>
